<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事">
<meta property="og:type" content="website">
<meta property="og:title" content="Acooly&#39;s Blog">
<meta property="og:url" content="http://acooly.github.io/page/2/index.html">
<meta property="og:site_name" content="Acooly&#39;s Blog">
<meta property="og:description" content="本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Acooly&#39;s Blog">
<meta name="twitter:description" content="本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://acooly.github.io/page/2/"/>





  <title>Acooly's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Acooly's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">coder live</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/12/01/acooly/2016-06-07-acooly genrate code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/01/acooly/2016-06-07-acooly genrate code/" itemprop="url">acooly getting start 自动代码生成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-01T16:02:00+08:00">
                2016-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/acooly开发框架/" itemprop="url" rel="index">
                    <span itemprop="name">acooly开发框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <style>img {max-width:100%;}</style>

<p>acooly框架设计理念为永远半自动化开发，70%的重复代码让程序自动生成，30%交给程序员发挥和创意。本节基于acooly框架封装的主线业务代码最佳实践，通过工具自动生成模块程序的骨架和基础功能。其中基础功能通过泛型封装，主要包括：CRUD，分页查询，列表查询，导入和导出.</p>
<blockquote>
<p>注意：本文以eclipse为案例进行说明,同时要求已根据acooly archetype生成了目标工程并成功运行。</p>
</blockquote>
<h3 id="框架约定"><a href="#框架约定" class="headerlink" title="框架约定"></a>框架约定</h3><p>acooly框架为了方便开发和设计，以开发经验为基础，对使用acooly进行了部分设计上的约定，通过约定降低设计和开发难度，提高效率。当然，这也符合流行的约定大于配置的设计理念。</p>
<h4 id="程序结构约定"><a href="#程序结构约定" class="headerlink" title="程序结构约定"></a>程序结构约定</h4><p>工程结构完全按maven j2ee工程骨架，这个可以通过acooly-archetype生成后就可以清楚展现，程序模块的设计开发有一下基本约定。</p>
<ul>
<li>实体类（entity）必须继承AbstractEntity,并提供一个名称为id的属性作为实体的唯一标识，同时也映射到数据库的物理主键。</li>
<li>每个模块的程序分为domian（entity和领域domain合并），dao，service和controller四层。命名规则依次为:EntityDao,EntityService,EntityManageController(后台)和EntityPortalController</li>
</ul>
<h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p>为了方便自动生成结构性代码，对数据库表结构设计进行部分约定，但都符合常规习惯。</p>
<ul>
<li>表名全部小写，不能以数字开头，必须添加备注</li>
<li>每个表必须有以id命名的物理主键，且为数字类型，如：mysql为bigint, oracle为number。</li>
<li>列名称全部小写，不能以数字开头；如果存在多个自然单词的组合，使用下划线分隔(_)。如：”user_type”</li>
<li>列定义必须添加备注 （这个备注则为生成的页面及表单的label）</li>
<li>每个表必须添加create_time和update_time两个日期时间类型的字段，但无需手动管理 （在save/update时，框架会自己维护创建时间和最后修改时间）。</li>
<li>如果有选项类型的字段，其选项值使用类json格式写入列备注字段，自动生成工具会自动为该列对应的属性和页面生成选项。如：表列为：user_type ,备注可以为：用户类型 {normal:普通,vip:高级}</li>
</ul>
<h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>自动代码生成的方案与目前流行的方式设计上是基本一致的。主要核心设计为：</p>
<ul>
<li>通过读取数据库的元数据，获得实体对应的表的所有列，类型，长度，可选，备注等信息，通过结构化处理作为自动代码生成的元数据。</li>
<li>通过freemarker作为模板引擎，定义一套或多套框架业务代码的最佳实践模板。</li>
<li>工具化自动生成目标代码，作为业务开发的start…</li>
</ul>
<p>目前的工具，形态只有cil和swt的简单界面（太懒，忘记开发插件）。 主要通过配置文件驱动工具行为，主配置文件为application.properties.</p>
<blockquote>
<p>工具的获取：请联系我~~</p>
</blockquote>
<p>下面以一个案例来简单说明这个开发过程。</p>
<h4 id="设计表"><a href="#设计表" class="headerlink" title="设计表"></a>设计表</h4><p>本案例中，我们以mysql为案例设计一个客户信息表，名称为:dm_customer, 表结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`dm_customer`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'ID'</span>,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户名'</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>,</span><br><span class="line">  <span class="string">`birthday`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'生日'</span>,</span><br><span class="line">  <span class="string">`gender`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'性别 &#123;1:男,2:女,3:人妖&#125;'</span>,</span><br><span class="line">  <span class="string">`mail`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'邮件'</span>,</span><br><span class="line">  <span class="string">`mobile_no`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'手机号码'</span>,</span><br><span class="line">  <span class="string">`real_name`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'姓名'</span>,</span><br><span class="line">  <span class="string">`idcard_no`</span> <span class="built_in">varchar</span>(<span class="number">18</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'身份证号码'</span>,</span><br><span class="line">  <span class="string">`subject`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'摘要'</span>,</span><br><span class="line">  <span class="string">`status`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'状态 &#123;0:无效,1:有效&#125;'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'修改时间'</span>,</span><br><span class="line">  <span class="string">`comments`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'备注'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<p>请将上面的表结构DLL在数据库中执行，生成本次演示的数据表。</p>
<blockquote>
<p>本案例基于本系列的第一篇文章《acooly archetype》，假设你已生成了工程，名称为acooly-demo，并建立数据库acooly，然后成功运行的基础上.</p>
</blockquote>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>打开工具包后，你会看到根目录下有application.properties文件，请打开进行配置，如果你运行startui.bat模式，也可以在ui界面进行配置。</p>
<p>application.propertes</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## database connection configurations</span></span><br><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/acooly?useUnicode=true&amp;amp;characterEncoding=UTF-8</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=******</span><br><span class="line"></span><br><span class="line"><span class="comment">## Code generator configurations</span></span><br><span class="line"><span class="comment"># 生成的代码防止的目标java工程根路径</span></span><br><span class="line">generator.workspace=/Users/zhangpu/workspace/eclipse/acooly-demo</span><br><span class="line"><span class="comment"># 生成的模块代码的根包</span></span><br><span class="line">generator.rootPackage=com.acooly.demo</span><br><span class="line"><span class="comment"># 生成的模块的业务根路径</span></span><br><span class="line">generator.pagePath=/manage/demo</span><br><span class="line"><span class="comment"># 表名转换为实体名称时，需要忽略的表的前缀。如:表明为dm_customer,配置该值为dm_ ,则生成的实体名称为Customer</span></span><br><span class="line">generator.tableToEntityIgnorPrefix=dm_</span><br><span class="line"><span class="comment"># 模板方案路径，默认设置为easyui</span></span><br><span class="line">generator.templatePath=classpath:/template/easyui</span><br><span class="line"></span><br><span class="line"><span class="comment">## maven project struction</span></span><br><span class="line">generator.codePath=src/main/java</span><br><span class="line">generator.testPath=src/test/java</span><br><span class="line">generator.resourcePath=src/main/resources</span><br><span class="line">generator.webappPath=src/main/webapp</span><br><span class="line">generator.viewSuffix=.jsp</span><br></pre></td></tr></table></figure>
<p>完成配置后，请保持退出，准备运行工具生成代码</p>
<h4 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h4><p>运行环境基础要求JDK1.7，本工具支持同时生成多张表到同一个模块。</p>
<p>解压开自动生成工具，根目录下存在start.bat,start.sh和start-ui64.bat等启动文件，如果你的windows，则可以直接cmd进入到当前目录，运行start.bat，根据提示输入需要自动生成的表名称，回车即可。</p>
<ul>
<li>如果你在一个模块中需要生成多个表，则多个表使用空格分隔</li>
<li>在使用命令前，请检测application.properties的配置文件正确配置</li>
</ul>
<p>运行情况如下（我这里是mac环境，使用start.sh，windows环境类似）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">请输入需要生成的表名(多个表使用空格分隔):dm_customer</span><br><span class="line">2016-06-07 23:28:31,934 DEBUG - Load metadata success--&gt; dm_customer</span><br><span class="line">2016-06-07 23:28:31,943 DEBUG - Configurations:</span><br><span class="line">com.acooly.module.coder.generate.GenerateConfiguration@38294acb[</span><br><span class="line">  workspace=/Users/zhangpu/workspace/eclipse/acooly-demo</span><br><span class="line">  rootPackage=com.acooly.demo</span><br><span class="line">  codePath=src/main/java</span><br><span class="line">  resourcePath=src/main/resources</span><br><span class="line">  webappPath=src/main/webapp</span><br><span class="line">  pagePath=/manage/demo</span><br><span class="line">  testPath=src/<span class="built_in">test</span>/java</span><br><span class="line">  templatePath=classpath:/template/easyui</span><br><span class="line">  tableToEntityIgnorPrefix=dm_</span><br><span class="line">  viewSuffix=.jsp</span><br><span class="line">]</span><br><span class="line">2016-06-07 23:28:31,974 DEBUG - Find reigstered ModuleGenerator: 7 --&gt; &#123;domainModuleGenerator=com.acooly.module.coder.module.impl.DomainModuleGenerator, jpaDaoModuleGenerator=com.acooly.module.coder.module.impl.JpaDaoModuleGenerator, daoTestModuleGenerator=com.acooly.module.coder.module.impl.DaoTestModuleGenerator, serviceInterfaceModuleGenerator=com.acooly.module.coder.module.impl.ServiceInterfaceModuleGenerator, serviceImplModuleGenerator=com.acooly.module.coder.module.impl.ServiceImplModuleGenerator, managerControllerModuleGenerator=com.acooly.module.coder.module.impl.ManagerControllerModuleGenerator, pagesModuleGenerator=com.acooly.module.coder.module.impl.PagesModuleGenerator&#125;</span><br><span class="line">2016-06-07 23:28:32,179 DEBUG - generate module with template(domain.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/java/com/acooly/demo/domain/Customer.java</span><br><span class="line">2016-06-07 23:28:32,183 DEBUG - Generate Module Success. -- &gt; DomainModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,185 DEBUG - generate module with template(dao.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/java/com/acooly/demo/dao/CustomerDao.java</span><br><span class="line">2016-06-07 23:28:32,185 DEBUG - Generate Module Success. -- &gt; JpaDaoModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,195 DEBUG - generate module with template(daoTest.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/<span class="built_in">test</span>/java/com/acooly/demo/dao/CustomerDaoTest.java</span><br><span class="line">2016-06-07 23:28:32,195 DEBUG - Generate Module Success. -- &gt; DaoTestModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,198 DEBUG - generate module with template(service.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/java/com/acooly/demo/service/CustomerService.java</span><br><span class="line">2016-06-07 23:28:32,198 DEBUG - Generate Module Success. -- &gt; ServiceInterfaceModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,200 DEBUG - generate module with template(serviceImpl.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/java/com/acooly/demo/service/impl/CustomerServiceImpl.java</span><br><span class="line">2016-06-07 23:28:32,200 DEBUG - Generate Module Success. -- &gt; ServiceImplModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,213 DEBUG - generate module with template(controller.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/java/com/acooly/demo/web/CustomerManagerController.java</span><br><span class="line">2016-06-07 23:28:32,213 DEBUG - Generate Module Success. -- &gt; ManagerControllerModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,239 DEBUG - generate module with template(listPage.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/webapp/manage/demo/customer.jsp</span><br><span class="line">2016-06-07 23:28:32,239 DEBUG - Generate Module Success. -- &gt; PagesModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,249 DEBUG - generate module with template(editPage.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/webapp/manage/demo/customerEdit.jsp</span><br><span class="line">2016-06-07 23:28:32,250 DEBUG - Generate Module Success. -- &gt; PagesModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,256 DEBUG - generate module with template(showPage.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/webapp/manage/demo/customerShow.jsp</span><br><span class="line">2016-06-07 23:28:32,257 DEBUG - Generate Module Success. -- &gt; PagesModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,260 DEBUG - generate module with template(importPage.ftl) to /Users/zhangpu/workspace/eclipse/acooly-demo/src/main/webapp/manage/demo/customerImport.jsp</span><br><span class="line">2016-06-07 23:28:32,260 DEBUG - Generate Module Success. -- &gt; PagesModuleGenerator</span><br><span class="line">2016-06-07 23:28:32,260 INFO  - Generate from [dm_customer] success.</span><br></pre></td></tr></table></figure>
<p>生成成功后，一般情况，只需重新启动服务器，从controller中找到访问的URL，配置到权限管理系统则可以直接访问，完成开发的第一步。</p>
<h3 id="运行查看效果"><a href="#运行查看效果" class="headerlink" title="运行查看效果"></a>运行查看效果</h3><p>OK，如果上步成功，请回到你的IDE，刷新工程，你应该看到在原来空的 src/main/java目录下存在了新生成的代码，并编译通过。同时在src/main/webapp/manage/demo下存在了该模块的管理界面。工程如图：</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/coder_module.png?raw=true" alt=""></p>
<h4 id="添加资源及菜单"><a href="#添加资源及菜单" class="headerlink" title="添加资源及菜单"></a>添加资源及菜单</h4><p>下面我们打开 CustomerManageController.java文件，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/manage/demo/customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerManagerController</span> <span class="keyword">extends</span> <span class="title">AbstractJQueryEntityController</span>&lt;<span class="title">Customer</span>, <span class="title">CustomerService</span>&gt; </span>&#123;</span><br><span class="line">	<span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>记录下该类的@RequestMapping的值: /manage/demo/customer ，用户在权限管理中配置资源和菜单。</p>
<p>下面我们调试启动服务器，并登录进入系统。访问系统管理中的资源管理，配置权限资源和菜单。</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/resource.png?raw=true" alt=""></p>
<blockquote>
<p>注意：如上图所示，资源的URL应该为前面记录的contoller的mapping值后加上/index.html,这个约定是为了简化资源，菜单和权限配置，资源默认的index.html则约定为入口菜单。</p>
</blockquote>
<h4 id="设置角色权限"><a href="#设置角色权限" class="headerlink" title="设置角色权限"></a>设置角色权限</h4><p>demo中，我们采用的是admin登录，默认为系统管理员权限，所以，在完成资源添加后，只需进入角色管理中为系统管理员勾选新设置的资源的访问权限即可。 系统管理 -&gt; 角色管理 -&gt; 系统管理员行后面的标记图标按钮。点击后如图：</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/role_setting.png?raw=true" alt=""></p>
<p>OK，设置完成后，请刷新菜单（在做不菜单栏的标题栏右边有个刷新图标），你会看到新的菜单出来了~~，当然如果找不到刷新图标，请直接刷新浏览器，一样样的~，不用重启哦~</p>
<p>点击 “业务管理” –&gt; “客户信息管理” 菜单，相信你会看到有一个查询列表显示出来，并且在表格的头上有一些操作按钮，如：添加，批量删除，导入导出等，请先不要管是否美观，排列是否合理，点击下添加，根据界面表单的非空提示，填入必选数据项，保存。是否成功添加了一条记录！？你可以点击新增的一行数据后面的修改和删除，尝试操作体验下~~ ，当然你可以导出~~，</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/def_list.png?raw=true" alt=""></p>
<p>OK,acooly声称的70%的工作已完成，下面就要靠程序员来完成该功能的调整了~</p>
<h3 id="程序员定制"><a href="#程序员定制" class="headerlink" title="程序员定制"></a>程序员定制</h3><p>调整定制前，先不要shutdown服务器，我们首先要调整的是界面，回到IDE，进入src/main/webapp/manage/demo目录，我们主要调整的是列表界面和编辑界面（添加和修改界面合一）。</p>
<h4 id="视图界面"><a href="#视图界面" class="headerlink" title="视图界面"></a>视图界面</h4><p>主要调整列表界面的查询条件和显示列，其他视图的定制，请参考后续文档~。</p>
<p><strong>查询条件</strong></p>
<p>默认情况下，自动代码生成工具不知道你这个模块需要什么查询条件，所有它把所有的列都生成了查询项，那么，我们程序就根据实际的业务场景，只需使用delete键，删除你觉得多余的查询条件即可，当然你可以调整查询条件的顺序和长度，他们都是基础的html表单。列表页面为：customer.jsp,如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">name</span>=<span class="string">"search_LIKE_username"</span> /&gt;</span></span><br><span class="line">手机号码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">name</span>=<span class="string">"search_LIKE_mobileNo"</span> /&gt;</span></span><br><span class="line">姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">name</span>=<span class="string">"search_LIKE_realName"</span>/&gt;</span></span><br><span class="line">状态:<span class="tag">&lt;<span class="name">select</span> <span class="attr">style</span>=<span class="string">"width:80px;"</span> <span class="attr">name</span>=<span class="string">"search_EQ_status"</span> <span class="attr">editable</span>=<span class="string">"false"</span> <span class="attr">panelHeight</span>=<span class="string">"auto"</span> <span class="attr">class</span>=<span class="string">"easyui-combobox"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>所有<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">var</span>=<span class="string">"e"</span> <span class="attr">items</span>=<span class="string">"$&#123;allStatuss&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;e.key&#125;"</span> $&#123;<span class="attr">param.search_EQ_status</span> == <span class="string">e.key?</span>'<span class="attr">selected</span>'<span class="attr">:</span>''&#125;&gt;</span>$&#123;e.value&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">创建时间:<span class="tag">&lt;<span class="name">input</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">id</span>=<span class="string">"search_GTE_createTime"</span> <span class="attr">name</span>=<span class="string">"search_GTE_createTime"</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">onFocus</span>=<span class="string">"WdatePicker(&#123;readOnly:true,dateFmt:'yyyy-MM-dd HH:mm:ss'&#125;)"</span> /&gt;</span></span><br><span class="line">至<span class="tag">&lt;<span class="name">input</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">id</span>=<span class="string">"search_LTE_createTime"</span> <span class="attr">name</span>=<span class="string">"search_LTE_createTime"</span> <span class="attr">size</span>=<span class="string">"15"</span> <span class="attr">onFocus</span>=<span class="string">"WdatePicker(&#123;readOnly:true,dateFmt:'yyyy-MM-dd HH:mm:ss'&#125;)"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>OK, 调整为以上查询条件，保留：用户名，手机，姓名，状态和创建时间作为查询条件。保持页面代码后，请切换到浏览器，刷新该tab（注意，不用整页刷新，框架页面右边有个刷新图标，只刷新当前tab）</p>
<p><strong>显示的列</strong></p>
<p>与查询条件一样，根据你的需要调整显示的列名，位置和格式（格式的话，稍微需要点javascript或easyui的基础哈）。我们调整如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"showCheckboxWithId"</span> <span class="attr">checkbox</span>=<span class="string">"true"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123; return row.id &#125;"</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"id"</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"username"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"realName"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"age"</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"birthday"</span> <span class="attr">formatter</span>=<span class="string">"formatDate"</span>&gt;</span>生日<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"gender"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value)&#123; return formatRefrence('manage_customer_datagrid','allGenders',value);&#125; "</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"idcardNo"</span>&gt;</span>身份证号码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"mail"</span>&gt;</span>邮件<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"mobileNo"</span>&gt;</span>手机号码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"status"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value)&#123; return formatRefrence('manage_customer_datagrid','allStatuss',value);&#125; "</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"createTime"</span> <span class="attr">formatter</span>=<span class="string">"formatDate"</span>&gt;</span>创建时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"rowActions"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123;return formatAction('manage_customer_action',value,row)&#125;"</span>&gt;</span>动作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>编辑界面</strong></p>
<p>编辑界面的名称为 customerEdit.jsp, 里面就是一个标准的form表单，请程序员根据需求进行布局调整，包括位置，表单大小，宽度等。</p>
<blockquote>
<p>一般情况，自动代码生成工具会把创建时间，修改时间也生成对应的表单，需要程序删除下，因为框架会自动管理这两个数据。其他非必填字段，也可以直接删除掉，关于非空和格式的check方案，我们直接使用easyui的官方标准方案并进行部分扩展，请参考easyui官方文档或后续acooly框架文档。</p>
</blockquote>
<p>OK，界面调整完成，我们刷新界面，新的界面就要人性化多了（这部分工作acooly觉得必须由程序员来做，我们不是神，做全自动，可能配置的时间比程序员调整的时间和成本还高~），可以给测试或用户使用啦~  </p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/mod_list.png?raw=true" alt=""></p>
<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><p>以上完成了一个acooly框架基础开发的案例，基本展示了acooly框架开发的模式。但在实际业务开发中这些远还不够，程序员根据实际业务的需求，还需要做很多工作，包括：多实体关联关系配置，业务逻辑服务编写和调用，页面的特殊定制等，但这些本应是程序员的职责，acooly框架提供的是把大量重复的工作自动化和工具化~，后续将逐步发布各种业务开发场景在前端和服务器端的开发说明，大量的组件能力说明~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/acooly/2016-03-05-acooly archetype/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/acooly/2016-03-05-acooly archetype/" itemprop="url">acooly archetype</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:16:46+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/acooly开发框架/" itemprop="url" rel="index">
                    <span itemprop="name">acooly开发框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>acooly快速开发框架最新的archetype方式新建项目工程骨架的说明文档。完全基于maven的构建思路，无特别学习成本。</p>
<blockquote>
<p>注意：本文以eclipse为案例进行说明。</p>
</blockquote>
<h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><p>首先，你最好使用eclipse自带maven插件的版本，如果没有maven插件请自行安装并配置好maven的setting.xml（3.x默认的就可以了~）和local repository。一切继续！</p>
<p>以上都是假设你是熟悉maven开发模式和环境的，并已配置好了eclipse及maven。我们使用eclipse来根据acooly-archetype新建工程骨架。</p>
<p> 第一步：启动maven工程向导</p>
<p> File菜单 –&gt; New –&gt; Project，选择Maven –&gt; Maven Project. 如下图：</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_1.png?raw=true" alt=""></p>
<p>选择“next”进入“New Maven project”中选择存储路径和workset后点击”next”：如图：</p>
<p>第二步：配置archetypes</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_2.png?raw=true" alt=""></p>
<p>如上图，点击红框部位的“configure…”按钮进入配置archetypes界面，如下图：</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_3.png?raw=true" alt=""></p>
<p>如上图中，点击“Add Remote Catalog…”,会弹出新增远程catalog的界面，如图：</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_4.png?raw=true" alt=""></p>
<p>在上图的”Catalog File”文本框中输入acooly的nexus catalog配置路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://acooly.cn/nexus/content/repositories/snapshots/archetype-catalog.xml</span><br></pre></td></tr></table></figure>
<p>在“Description”中输入“acooly…”,然后点击“OK”，然后再点击OK回到创建工程向导界面~~</p>
<p>第三步：根据archetype创建工程</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_5.png?raw=true" alt=""></p>
<p>如上图所示，选择上一步新增的Catalog：acooly,并勾选“Include snapshot archetypes”选项。然后界面会显示出acooly-archetype,选中后，点击next进入工程初始配置界面。</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_6.png?raw=true" alt=""></p>
<p>如上图：进入到“New Maven Project”的配置界面，请根据进自己的工程情况，输入“GroupId”等参数后，点击“finish”按钮完成创建向导，稍等一会（网络要通哈~~），会在你的eclipse的explorer中看到你的新建的工程。</p>
<h3 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h3><p>在创建工程成功完成后，完全展开你的工程如图：</p>
<p><img src="https://github.com/acooly/acooly.github.io/blob/master/_posts/resource/images/acooly/archetype_7.png?raw=true" alt=""></p>
<p>如上图：图中已有文字说明~~~</p>
<h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><p>请随便找一个mysql数据库（5.5以上），新建一个名字为“acooly”的数据库，字符集为UTF-8。SQL如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`acooly`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span></span><br></pre></td></tr></table></figure>
<p>然后将工程内的src/main/database/mysql.sql导入到新建的acooly数据库中。你可以使用你最熟悉的方式导入。这里以命令方式介绍。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pxxxxx acooly &lt; mysql.sql</span><br></pre></td></tr></table></figure>
<h3 id="修改工程配置文件"><a href="#修改工程配置文件" class="headerlink" title="修改工程配置文件"></a>修改工程配置文件</h3><p>如果想立即运行工程看效果，你只需要修改主配置文件的数据库用户名和密码。打开文件：src/main/resources/application.dev.properties。修改jdbc.username和jdbc.password为你的数据库的用户名和密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=123456</span><br></pre></td></tr></table></figure>
<h3 id="运行Demo"><a href="#运行Demo" class="headerlink" title="运行Demo"></a>运行Demo</h3><p>现在可以启动了，请参考“工程结构”模块中的结构图中：嵌入式tomcat开发调试工具，请右键它，选择：Debug As –&gt; Java Application. 一会，你的Console中会开始打印日志，最后会显示启动成功，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">********************************************************</span><br><span class="line">启动成功: http://localhost:8090   in:16014ms</span><br><span class="line">********************************************************</span><br></pre></td></tr></table></figure>
<p>OK,启动成功，请打开浏览器输入：<a href="http://localhost:8090" target="_blank" rel="noopener">http://localhost:8090</a>, 进应该会看到登录界面。账户：admin/111111</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/Web负载均衡和高可用/2012-01-15-Apache2.x安装配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/Web负载均衡和高可用/2012-01-15-Apache2.x安装配置/" itemprop="url">Apache2.x安装配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:16:35+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文描述APACHE在各个常见的环境中的安装配置和常见问题收集整理。这是一件持续的事情。以：Apache httpd-2.2.21 为例。 以操作系统超级管理员作为操作用户。</p>
<h3 id="windows-版本安装"><a href="#windows-版本安装" class="headerlink" title="windows 版本安装"></a>windows 版本安装</h3><p>windows各个版本的安装基本相同，也非常简单。windows版本安装后，所有的扩展mod都默认全部安装，只需要通过http.conf主配置文件进行LoadModule配置就OK。</p>
<p><strong>下载</strong></p>
<p><a href="http://labs.renren.com/apache-mirror//httpd/binaries/win32/httpd-2.2.21-win32-x86-openssl-0.9.8r.msi" target="_blank" rel="noopener">http://labs.renren.com/apache-mirror//httpd/binaries/win32/httpd-2.2.21-win32-x86-openssl-0.9.8r.msi</a></p>
<p><strong>安装</strong></p>
<p>采用自定义安装，选择安装目录后，直接安装成服务，其他所有选择默认配置。</p>
<h3 id="Linux编译安装"><a href="#Linux编译安装" class="headerlink" title="Linux编译安装"></a>Linux编译安装</h3><h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><ul>
<li>磁盘空间：50M临时文件空间，至少需要10M的程序空间。</li>
<li>编译环境：ANSI-C Compiler,推荐GCC</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gcc -v</span></span><br><span class="line">Using built-in specs.</span><br><span class="line">Target: i386-redhat-linux</span><br><span class="line">……</span><br><span class="line">gcc version 4.1.1 20070105 (Red Hat 4.1.1-52)</span><br></pre></td></tr></table></figure>
<ul>
<li>apr/apr-util &gt;= 1.2<br>如果apr/apr-util不存在可以再后续的安装包中先安装。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q apr</span></span><br><span class="line">apr-1.2.7-11</span><br></pre></td></tr></table></figure>
<h4 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## download httpd</span></span><br><span class="line">wget http://labs.renren.com/apache-mirror//httpd/httpd-2.2.21.tar.gz  </span><br><span class="line">tar -xzvf httpd-2.2.21.tar.gz </span><br><span class="line"><span class="built_in">cd</span> httpd-2.2.21</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装apr/apr-util</span></span><br><span class="line"><span class="built_in">cd</span> srclib/apr</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/apr-httpd/</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">## Build and install apr-util 1.2</span></span><br><span class="line"><span class="built_in">cd</span> ../apr-util</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/apr-util-httpd/ --with-apr=/usr/<span class="built_in">local</span>/apr-httpd/</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">## 编译安装httpd</span></span><br><span class="line"><span class="built_in">cd</span> ../../</span><br><span class="line">./configure --with-apr=/usr/<span class="built_in">local</span>/apr-httpd/ --with-apr-util=/usr/<span class="built_in">local</span>/apr-util-httpd/</span><br></pre></td></tr></table></figure>
<h4 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h4><p>要实现apache自启动，最好的办法就是加入linux服务中。如果是编译方式，方法如下：<br>默认安装目录：/usr/local/apache2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/apache2/bin/apachectl /etc/rc.d/init.d/httpd</span><br><span class="line"><span class="comment">### 使用vi或vim打开httpd文件，在文件头部加入如下内容：</span></span><br><span class="line"><span class="comment">#///</span></span><br><span class="line"><span class="comment"># Comments to support chkconfig on RedHat Linux</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 90 90</span></span><br><span class="line"><span class="comment"># description:http server</span></span><br><span class="line"><span class="comment">#///</span></span><br><span class="line"><span class="comment">### 使用:wq保存退出</span></span><br><span class="line"></span><br><span class="line">chkconfig --add httpd</span><br><span class="line">chkconfig --level 35 httpd on</span><br></pre></td></tr></table></figure>
<blockquote>
<p>等级0表示：表示关机<br>等级1表示：单用户模式<br>等级2表示：无网络连接的多用户命令行模式<br>等级3表示：有网络连接的多用户命令行模式<br>等级4表示：不可用<br>等级5表示：带图形界面的多用户模式<br>等级6表示：重新启动</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/2015-12-19-redis linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/2015-12-19-redis linux/" itemprop="url">Linux redis安装配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:16:19+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>linux下的安装中，redis本身依赖较少，所以直接根据官网的说明安装就OK。</p>
<blockquote>
<p>官网地址：<a href="http://www.redis.io/download" target="_blank" rel="noopener">http://www.redis.io/download</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.0.3.tar.gz</span><br><span class="line">tar -xzvf redis-3.0.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-3.0.3</span><br></pre></td></tr></table></figure>
<p>安装gcc编译器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br></pre></td></tr></table></figure>
<p>建议要运行：make test验证下编译情况。如果运行报错没有对应的tcl包，则需要先安装该包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tcl</span><br></pre></td></tr></table></figure>
<p>或则:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://downloads.sourceforge.net/tcl/tcl8.6.1-src.tar.gz</span><br><span class="line">sudo tar xzvf tcl8.6.1-src.tar.gz  -C /usr/<span class="built_in">local</span>/</span><br><span class="line"><span class="built_in">cd</span>  /usr/<span class="built_in">local</span>/tcl8.6.1/unix/</span><br><span class="line">sudo ./configure</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>然后我们在运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make <span class="built_in">test</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果运行make报错：Newer version of jemalloc required，则使用：make MALLOC=libc 代替 make</p>
</blockquote>
<p>安装完成后，redis的可执行文件在：/usr/local/bin，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ll</span></span><br><span class="line">总用量 15436</span><br><span class="line">-rwxr-xr-x 1 root root 4583659 8月  20 02:29 redis-benchmark</span><br><span class="line">-rwxr-xr-x 1 root root   22217 8月  20 02:29 redis-check-aof</span><br><span class="line">-rwxr-xr-x 1 root root   45435 8月  20 02:29 redis-check-dump</span><br><span class="line">-rwxr-xr-x 1 root root 4686742 8月  20 02:29 redis-cli</span><br><span class="line">lrwxrwxrwx 1 root root      12 8月  20 02:29 redis-sentinel -&gt; redis-server</span><br><span class="line">-rwxr-xr-x 1 root root 6454431 8月  20 02:29 redis-server</span><br></pre></td></tr></table></figure>
<p>配置文件在源代码当前目录下：redis.conf</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="服务器参数"><a href="#服务器参数" class="headerlink" title="服务器参数"></a>服务器参数</h4><p>首先拷贝默认配置文件到/etc/下，便于管理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf /etc/</span><br></pre></td></tr></table></figure>
<p>主要修改redis.conf配置：</p>
<ul>
<li>daemonize yes #转为守护进程，否则启动时会每隔5秒输出一行监控信息 </li>
<li>save 60 1000 #减小改变次数，其实这个可以根据情况进行指定 </li>
<li>maxmemory 256000000 #分配256M内存</li>
</ul>
<p>如果内存情况比较紧张的话，需要设定内核参数：<br>echo 1 &gt; /proc/sys/vm/overcommit_memory  </p>
<p>/etc/sysctl.conf<br>添加<br>vm.overcommit_memory=1<br>刷新配置使之生效<br>sysctl vm.overcommit_memory=1  </p>
<blockquote>
<p>overcommit_memory文件指定了内核针对内存分配的策略，其值可以是0、1、2。 </p>
</blockquote>
<blockquote>
<ul>
<li>0:表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。 </li>
<li>1:表示内核允许分配所有的物理内存，而不管当前的内存状态如何。 </li>
<li>2:表示内核允许分配超过所有物理内存和交换空间总和的内存 </li>
</ul>
</blockquote>
<h4 id="linux服务"><a href="#linux服务" class="headerlink" title="linux服务"></a>linux服务</h4><p>安装完成后，源代码目录下utils目录存在redis_init_script脚本，我们以此为基础制作自启动服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp redis_init_script /etc/init.d/redis</span><br><span class="line">vim /etc/init.d/redis</span><br></pre></td></tr></table></figure>
<p>修改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PIDFILE=/var/run/redis_<span class="variable">$&#123;REDISPORT&#125;</span>.pid</span><br><span class="line">CONF=<span class="string">"/etc/redis/<span class="variable">$&#123;REDISPORT&#125;</span>.conf"</span></span><br></pre></td></tr></table></figure>
<p>为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PIDFILE=/var/run/redis.pid</span><br><span class="line">CONF=<span class="string">"/etc/redis.conf"</span></span><br></pre></td></tr></table></figure>
<p>文件顶部注释修改为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/<span class="keyword">sh</span></span><br><span class="line"># chkconfi<span class="variable">g:</span> <span class="number">345</span> <span class="number">87</span> <span class="number">87</span></span><br><span class="line"># description: redis</span><br></pre></td></tr></table></figure>
<p>最后，redis文件如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/<span class="keyword">sh</span></span><br><span class="line"># chkconfi<span class="variable">g:</span> <span class="number">345</span> <span class="number">87</span> <span class="number">87</span></span><br><span class="line"># description: redis</span><br><span class="line">#</span><br><span class="line"># Simple Redis init.d script conceived <span class="keyword">to</span> work <span class="keyword">on</span> Linux systems</span><br><span class="line"># <span class="keyword">as</span> it does use of the /proc filesystem.</span><br><span class="line"></span><br><span class="line">REDISPORT=<span class="number">6379</span></span><br><span class="line">EXEC=/usr/local/bin/redis-server</span><br><span class="line">CLIEXEC=/usr/local/bin/redis-cli</span><br><span class="line"></span><br><span class="line">PIDFILE=/var/run/redis.pid</span><br><span class="line">CONF=<span class="string">"/etc/redis.conf"</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>把redis自启动脚本加入到linux服务并设置自启动参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chkconfig --add redis</span><br><span class="line">$ chkconfig --list redis</span><br><span class="line">redis  0:关闭	1:关闭	2:关闭	3:启用	4:启用	5:启用	6:关闭</span><br></pre></td></tr></table></figure>
<p>启动服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ service redis start</span><br><span class="line">Starting Redis server...</span><br></pre></td></tr></table></figure>
<p>状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps ax|grep redis</span><br><span class="line">26716 ?  Ssl  0:00 /usr/<span class="built_in">local</span>/bin/redis-server *:6379</span><br></pre></td></tr></table></figure>
<p>停止服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ service redis stop</span><br><span class="line">Stopping ...</span><br><span class="line">Redis stopped</span><br></pre></td></tr></table></figure>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>重新启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service redis start</span></span><br><span class="line"><span class="comment"># redis-cli -h 127.0.0.1 -p 6379</span></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">echo</span> hi</span><br><span class="line"><span class="string">"hi"</span></span><br><span class="line">127.0.0.1:6379&gt; incr foo</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; get foo</span><br><span class="line"><span class="string">"1"</span></span><br><span class="line">127.0.0.1:6379&gt; get noexists</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; key *</span><br><span class="line">(error) ERR unknown <span class="built_in">command</span> <span class="string">'key'</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">"foo"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/2015-12-28-discuz与java系统整合登录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/2015-12-28-discuz与java系统整合登录/" itemprop="url">Discuz安装配置与java系统同步登录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:14:40+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文主要是我在某项目中集成java开发的网站平台与Discuz3.1单项同步登录的日志。几经周折，解决一个个的问题后，终于完成Discuz3.1论坛环境搭建，并实现业务网站登录后自动单项同步登录论坛的整合。</p>
<blockquote>
<p>感慨：完善的Discuz开源论坛，大部分实用的整合调整都需要修改PHP代码才能完成~，真完善啊~~</p>
</blockquote>
<h3 id="Discuz论坛安装配置"><a href="#Discuz论坛安装配置" class="headerlink" title="Discuz论坛安装配置"></a>Discuz论坛安装配置</h3><h4 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h4><ul>
<li>discuz3.1 utf-8版本，对应的ucenter-1.6.0</li>
<li>CentOS-6.5-64位</li>
</ul>
<h4 id="环境安装配置"><a href="#环境安装配置" class="headerlink" title="环境安装配置"></a>环境安装配置</h4><p>我选择的目标环境是LAMP环境。详细安排配置请参考：<a href="http://acooly.github.io/linux/linux_lamp.html" title="linux lamp非主流搭建">http://acooly.github.io/linux/linux_lamp.html</a></p>
<h4 id="discuz安装配置"><a href="#discuz安装配置" class="headerlink" title="discuz安装配置"></a>discuz安装配置</h4><p>目标LAMP环境安装好后，discuz的安装如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wget</span> http://download.comsenz.com/DiscuzX/3.1/Discuz_X3.1_SC_UTF8.zip</span><br><span class="line">...</span><br><span class="line">$ tar -xzvf Discuz_X3.1_SC_UTF8.zip</span><br><span class="line">$ <span class="built_in">cd</span> discuz</span><br><span class="line">$ ls</span><br><span class="line">readme  upload  utility</span><br><span class="line">$ <span class="built_in">cd</span> upload</span><br><span class="line"><span class="comment">## /opt/www为apache主目录</span></span><br><span class="line">$ cp -r * /opt/www</span><br></pre></td></tr></table></figure>
<p>安装完成后，如果apache没有启动，则先启动apache</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service httpd start</span><br></pre></td></tr></table></figure>
<p>在前端打开浏览器输入地址访问apache，首次访问会弹出安装向导，按向导简单安装即可设置完成，这些图片就不帖的，因为的确没有特别说明的地方。</p>
<p>OK，安装完成，现在可以访问论坛首页了，但是这肯定不是我们要的论坛。下面介绍下我的论坛设置部分。</p>
<h4 id="论坛设置和改造"><a href="#论坛设置和改造" class="headerlink" title="论坛设置和改造"></a>论坛设置和改造</h4><p>因为不会PHP，只有根据需求不断的找论坛后台的管理功能+百度（google无意义，这玩意是中国造）搜索解决目标需求。</p>
<h5 id="论坛标题"><a href="#论坛标题" class="headerlink" title="论坛标题"></a>论坛标题</h5><p>想M娘的就是修改各标题都不能完全在管理系统搞定，还要修改源代码~ 热，热，热，重要的事情说三次。</p>
<ul>
<li>论坛后台：全局-&gt;站点信息-&gt;站点名称</li>
<li>后台：全局-&gt;SEO设置-&gt;论坛-&gt;title</li>
<li>源代码：template/default/common/header_common.htm 内查找 “Powered by Discuz!”，并按自己的想法修改网站标题。</li>
</ul>
<h5 id="论坛图标"><a href="#论坛图标" class="headerlink" title="论坛图标"></a>论坛图标</h5><p>这个简单，删除论坛根目录下的favicon.ico，上传一个你自己的favicon.ico替换就OK，注意要清楚本地浏览器缓存才能更新，或者在chrome中使用ctrl+f5可以更新，其他浏览器没有试~</p>
<h5 id="修改LOGO"><a href="#修改LOGO" class="headerlink" title="修改LOGO"></a>修改LOGO</h5><ul>
<li>后台: 界面 -&gt; 风格管理 -&gt; 站点Logo</li>
</ul>
<h5 id="底部友情链接"><a href="#底部友情链接" class="headerlink" title="底部友情链接"></a>底部友情链接</h5><ul>
<li>后台：运营 -&gt; 友情链接</li>
</ul>
<h5 id="底部右侧链接（底部导航）"><a href="#底部右侧链接（底部导航）" class="headerlink" title="底部右侧链接（底部导航）"></a>底部右侧链接（底部导航）</h5><ul>
<li>后台：界面 -&gt; 底部导航</li>
</ul>
<h5 id="后台频繁重复登录"><a href="#后台频繁重复登录" class="headerlink" title="后台频繁重复登录"></a>后台频繁重复登录</h5><ul>
<li>取消检测管理员ip：源代码：config/config_global.php文件中</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_config[<span class="string">'admincp'</span>][<span class="string">'checkip'</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">## 修改成：</span></span><br><span class="line">$_config[<span class="string">'admincp'</span>][<span class="string">'checkip'</span>] = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>修改后台活跃时间限制：源代码：source/class/discuz/discuz_admincp.php文件中：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $sessionlife = <span class="number">1800</span>; </span><br><span class="line"><span class="comment">## 修改为：</span></span><br><span class="line"><span class="keyword">var</span> $sessionlife = <span class="number">7200</span>;</span><br></pre></td></tr></table></figure>
<h4 id="UCenter设置和改造"><a href="#UCenter设置和改造" class="headerlink" title="UCenter设置和改造"></a>UCenter设置和改造</h4><h5 id="UCenter始终无法登录"><a href="#UCenter始终无法登录" class="headerlink" title="UCenter始终无法登录"></a>UCenter始终无法登录</h5><p>3.1默认安装完成后，集成了ucenter-1.6.0，默认情况下，进入ucenter登录界面，那个牛B的验证码经常显示不出来字，反正绝对不是人类能看懂的，刷个N次有时候回出来一个看懂的。但是使用chrome打死是登录不了的。我试了网上说的N种办法都无效~~~</p>
<p>最终解决：<br>使用IE9在刷出验证码的情况下，成功登录~~ 热，热，热。三次，不想去研究为什么~~</p>
<h5 id="Ucenter应用无法同步登录"><a href="#Ucenter应用无法同步登录" class="headerlink" title="Ucenter应用无法同步登录"></a>Ucenter应用无法同步登录</h5><p>使用的是某哥们的discuz-ucenter-api-for-java。</p>
<p>坑：<br>如果ucenter只有一个应用或者只有一个同步登录的应用，ucenter的uc_user_synlogin是不会返回值的。别用ucenter里面的默认的那个应用，自己建一个才行~~</p>
<h5 id="UCenter注册后自动激活"><a href="#UCenter注册后自动激活" class="headerlink" title="UCenter注册后自动激活"></a>UCenter注册后自动激活</h5><blockquote>
<p>坑：网上都是说源代码在uc_client/model/user.php中的add_user方法的最后一行前加入代码同步写入到discuz论坛的表中解决。我试了N次，发现根本没有执行，一想，远程调用UCenter接口注册，对UCenter来说是提供服务撒，是否应该在在uc_server/model/user.php中的方法哦~，验证之，对了~ 热，热，热~</p>
</blockquote>
<p>正解：</p>
<p>源代码：uc_server/model/user.php中找到add_user方法，在return $uid;前加入代码,如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO "</span>.UC_DBTABLEPRE.<span class="string">"memberfields SET uid='$uid'"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// BEGIN</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO `discuz`.pre_common_member SET uid='$uid', username='$username', password='$password', email='$email', adminid='0', groupid='10', regdate='"</span>.<span class="keyword">$this</span>-&gt;base-&gt;time.<span class="string">"', credits='0', timeoffset='9999'"</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO `discuz`.pre_common_member_status SET uid='$uid', regip='$regip', lastip='$regip', lastvisit='"</span>.<span class="keyword">$this</span>-&gt;base-&gt;time.<span class="string">"', lastactivity='"</span>.<span class="keyword">$this</span>-&gt;base-&gt;time.<span class="string">"', lastpost='0', lastsendmail='0'"</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO `discuz`.pre_common_member_profile SET uid='$uid'"</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO `discuz`.pre_common_member_field_forum SET uid='$uid'"</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO `discuz`.pre_common_member_field_home SET uid='$uid'"</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"INSERT INTO `discuz`.pre_common_member_count SET uid='$uid', extcredits1='0', extcredits2='0', extcredits3='0', extcredits4='0', extcredits5='0', extcredits6='0', extcredits7='0', extcredits8='0'"</span>);</span><br><span class="line"><span class="comment">// END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $uid;</span><br></pre></td></tr></table></figure>
<p>不想写了~~，睡觉，主要的坑都记录下来了~，后续再补充详细的java系统整合方案：自动注册+自动登录+密码解决方案</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/2016-01-21-linux实用svn服务器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/2016-01-21-linux实用svn服务器/" itemprop="url">linux实用svn服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:14:32+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>本案适用CentOS6.X,搭建nginx+apache+svn的服务器，本文只介绍apache+svn相关类型，nginx只是作为最后反向代理出去的口子。一般安装模式分为yum或下载源代码编译安装两种方式，本文采用简单的yum方式安装，不追求最新版本，主要是为了迁移原来老的windows svn服务器到linux环境。<br>在完成服务器搭建后，在针对重点项目或目录设置提交必填注释的配置，后续再介绍实用hotcopy本地备份+rsync远程备份的备份方案。<br>在安装配置过程中，也遇到些小问题，这里顺便记录；同时记录些常用配置，备份和回复的方案操作，曾经在windows下磁盘坏过，也没有备份，痛苦过~~</p>
<h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><p>以下安装记录为完成后根据记忆记录，没有在xshell记录日志。</p>
<h4 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd</span><br><span class="line">yum install subversion</span><br><span class="line">yum install mod_dav_svn</span><br></pre></td></tr></table></figure>
<h4 id="配置SVN"><a href="#配置SVN" class="headerlink" title="配置SVN"></a>配置SVN</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/svn</span><br><span class="line"><span class="built_in">cd</span> /data/svn</span><br><span class="line">svnadmin create <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 设置权限，否则会是只读</span></span><br><span class="line">chown apache.apache -R <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 创建用户密码文件</span></span><br><span class="line">htpasswd -c passwd acooly</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 创建权限文件（权限配置语法，请参考百度，google）</span></span><br><span class="line"><span class="built_in">echo</span> -e [/]\nacooly=rw &gt; authz</span><br></pre></td></tr></table></figure>
<h4 id="配置apache"><a href="#配置apache" class="headerlink" title="配置apache"></a>配置apache</h4><p>打开配置文件，加入SVN服务相关配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/subversion.conf</span><br></pre></td></tr></table></figure>
<p>删除或注释掉原有配置，加入以下配置，保存退出（:wq）</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Location /svn/&gt;</span><br><span class="line">    DAV svn</span><br><span class="line">    SVNParentPath /data/svn</span><br><span class="line">    AuthzSVNAccessFile /data/svn/authz</span><br><span class="line">    SVNListParentPath <span class="keyword">on</span></span><br><span class="line">    AuthType Basic</span><br><span class="line">    AuthName <span class="string">"Acooly Subversion"</span></span><br><span class="line">    AuthUserFile /data/svn/passwd</span><br><span class="line">    Require valid-user</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>
<p>打开主配置文件，修改下ServerName参数，否则启动会提示个小警告。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure>
<p>查找ServerName,修改为:<br>ServerName:localhost:80</p>
<h4 id="启动验证"><a href="#启动验证" class="headerlink" title="启动验证"></a>启动验证</h4><p>因采用yum方式安装的httpd，所以默认情况已加入服务，这里采用服务方式启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service httpd start</span><br></pre></td></tr></table></figure>
<p>打开本地浏览器，输入httpd的访问地址：<a href="http://ip:port/svn/" target="_blank" rel="noopener">http://ip:port/svn/</a>, 如果提示baisc方式认证，输入前面设置acooly账户及密码能正常进入并看到test工程，则表示成功。</p>
<h3 id="常用设置"><a href="#常用设置" class="headerlink" title="常用设置"></a>常用设置</h3><h4 id="提交必须写注释"><a href="#提交必须写注释" class="headerlink" title="提交必须写注释"></a>提交必须写注释</h4><p>对于一些重点的项目或工程，每次修改必须强制填写提交注释，便于追踪。目前一般采用hooks方式</p>
<p>在你需要控制的仓库目录的hooks目录下新建一个名字为pre-commit的文件，并为其添加执行权限，那么每次提交本仓库的时候都会执行该脚本，通过脚本中检查注释的长度控制提交成功或失败。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/svn/<span class="built_in">test</span>/hooks</span><br><span class="line">touch pre-commit</span><br><span class="line">chmod +x pre-commit</span><br></pre></td></tr></table></figure>
<p>通过VIM增加pre-commit脚本内容如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/<span class="keyword">sh</span></span><br><span class="line">REPOS=<span class="string">"$1"</span></span><br><span class="line">TXN=<span class="string">"$2"</span></span><br><span class="line">SVNLOOK=/usr/bin/svnlook</span><br><span class="line">LOGMSG=$($SVNLOOK <span class="built_in">log</span> -t <span class="string">"$TXN"</span> <span class="string">"$REPOS"</span> | <span class="keyword">grep</span> <span class="string">"[a-zA-Z0-9]"</span> | wc -<span class="keyword">c</span>)</span><br><span class="line">if [ "$LOGMSG" -lt 5 ]; then</span><br><span class="line"><span class="keyword">echo</span> -<span class="keyword">e</span> <span class="string">"\n commit fail! comment required latest 5 charactors"</span> <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>OK,现在到客户端提交版本，如果不输入字少5个字符的注释，则会提交失败。</p>
<blockquote>
<p>注意：这里的错误提示使用的是英文，原因是我在linux(LANG=UTF-8)无法正常使用中文，总是报不能转换为UTF-8, 使用多种export LANG编码后无效，只有先使用英文。</p>
</blockquote>
<h3 id="备份恢复"><a href="#备份恢复" class="headerlink" title="备份恢复"></a>备份恢复</h3><p>请参考：<a href="/linux/linux实用svn服务远程备份.html">linux实用svn服务远程备份</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/2016-01-23-linux实用svn服务远程备份/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/2016-01-23-linux实用svn服务远程备份/" itemprop="url">linux svn服务远程备份</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:14:24+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>前面通过CentOS6.5系统的yum方式安装部署了新的SVN服务器，并迁移了原来老的windows服务。鉴于单点和单份数据是肯定不可靠的，所以做个远程SVN服务数据备份。</p>
<p>本方案主要方式为：</p>
<ul>
<li>首先在linux svn服务器上通过定时任务，使用svnadmin hotcopy安全备份到服务器上的备份目录</li>
<li>然后通过设置时间差，在家里的windows服务器上通过rsync增量备份服务器上的备份数据在本地。</li>
</ul>
<h3 id="本地备份"><a href="#本地备份" class="headerlink" title="本地备份"></a>本地备份</h3><p>首先编写一个脚本，循环备份所有的SVN仓库到备份目录，然后加入到系统crontab中，定时每天凌晨1点备份，不是很大，总共只有1G+数据，使用阿里云服务器环境，几秒到几十秒钟就完成，必windows pc快了N备。</p>
<h4 id="备份脚本程序"><a href="#备份脚本程序" class="headerlink" title="备份脚本程序"></a>备份脚本程序</h4><p>我规划：</p>
<ul>
<li>SVN服务的数据目录为 ： /data/svn</li>
<li>备份程序目录为:/data/backup，下面三个子目录：bin, log ,data,其中data/svn存放svn仓库的备份数据。</li>
</ul>
<p>脚本程序如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># for subversion server data backup with hotcopy script</span></span><br><span class="line"><span class="comment">#set -e errexit</span></span><br><span class="line"></span><br><span class="line">backup_home=/data/backup</span><br><span class="line">svn_home=/data/svn</span><br><span class="line">svn_backup_home=<span class="variable">$backup_home</span>/data/svn</span><br><span class="line">svn_backup_log=<span class="variable">$backup_home</span>/<span class="built_in">log</span>/svn.log</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">log</span></span>()&#123;</span><br><span class="line">  <span class="built_in">local</span> ct=`date <span class="string">'+%Y-%m-%d %H:%M:%S'</span>`</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$ct</span> - <span class="variable">$1</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$ct</span> - <span class="variable">$1</span> &gt;&gt; <span class="variable">$svn_backup_log</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">backup_repo</span></span>()&#123;</span><br><span class="line">  <span class="built_in">local</span> repo=<span class="variable">$1</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$repo</span>"</span> == <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">log</span> <span class="string">"the repo is empty, exit!"</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">log</span> <span class="string">"start backup repo: <span class="variable">$repo</span>"</span></span><br><span class="line">  svnadmin hotcopy <span class="variable">$svn_home</span>/<span class="variable">$repo</span> <span class="variable">$svn_backup_home</span>/<span class="variable">$&#123;repo&#125;</span>_tmp</span><br><span class="line">  <span class="keyword">if</span> [ -d <span class="variable">$svn_backup_home</span>/<span class="variable">$repo</span> ]; <span class="keyword">then</span></span><br><span class="line">    rm -fr <span class="variable">$svn_backup_home</span>/<span class="variable">$repo</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  mv <span class="variable">$svn_backup_home</span>/<span class="variable">$&#123;repo&#125;</span>_tmp <span class="variable">$svn_backup_home</span>/<span class="variable">$repo</span></span><br><span class="line">  <span class="built_in">log</span> <span class="string">"finish backup repo: <span class="variable">$repo</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">backup</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> file <span class="keyword">in</span> `ls <span class="variable">$svn_home</span>`</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="variable">$svn_home</span>/<span class="variable">$file</span> ]; <span class="keyword">then</span></span><br><span class="line">	backup_repo <span class="variable">$file</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> &gt;&gt; <span class="variable">$svn_backup_log</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backup</span><br></pre></td></tr></table></figure>
<p>该脚本执行后，会循环备份所有svn服务器的仓库到/data/backup/data/svn目录，同时记录当前备份的日志到log/svn.log文件。</p>
<h4 id="定时执行"><a href="#定时执行" class="headerlink" title="定时执行"></a>定时执行</h4><p>我规划每天凌晨1点执行一次备份脚本。</p>
<blockquote>
<p>这里使用系统方式设置定时任务，如果需要按用户方式请使用crontab -e</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"0  1  *  *  * /data/backup/bin/svn_backup.sh"</span> &gt;&gt; /etc/crontab</span><br></pre></td></tr></table></figure>
<h3 id="远程备份"><a href="#远程备份" class="headerlink" title="远程备份"></a>远程备份</h3><p>通过cwRsync软件，在本地定时增量备份远程的rsync暴露的svn备份服务。</p>
<h4 id="rsync服务器"><a href="#rsync服务器" class="headerlink" title="rsync服务器"></a>rsync服务器</h4><p>在svn服务器上，直接采用yum方式安装，然后再设置备份目录。</p>
<p>配置方式，请参考：<a href="/linux/rsync同步文件.html">rsync同步文件</a> 的 “服务端配置(服务器A)”章节。</p>
<h4 id="cwRsync客户端"><a href="#cwRsync客户端" class="headerlink" title="cwRsync客户端"></a>cwRsync客户端</h4><p>下载cwRsync客户端，地址：<a href="http://www.rsync.net/resources/binaries/cwRsync_3.1.0_Installer.zip" target="_blank" rel="noopener">http://www.rsync.net/resources/binaries/cwRsync_3.1.0_Installer.zip</a></p>
<p>直接解压则可用，cwRsync是通过cygwin方式运行的，但默认不需要去单独安装cygwin.</p>
<ul>
<li>服务端rsync保留的共享服务为：svn</li>
<li>我规划在e:\backup\svn目录作为备份目录。</li>
</ul>
<p>先准备密码文件:rsyncd.secrets文件，存放服务器端svn共享目录配置的密码。生成密码文件后，需要设置其600权限。默认cwRsync的bin目录下有个chmod命令来设置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 rsyncd.secrets</span><br></pre></td></tr></table></figure>
<p>有几点需要注意：</p>
<ul>
<li>客户端的rsyncd.secrets文件与服务器端不同，只需保持密码，没有用户名。</li>
<li>如果rwRsync下的chmod命令报错，则需要下载一个cygwin安装（随便百度下就能下载到，然后默认安装就OK）后，使用Cygwin Terminal终端工具设置rsyncd.secrets的600权限，命令相同。</li>
</ul>
<p>以上准备工作做好后，使用:rsynclient-svn.bat脚本，修改对应的目录后，进行测试。如果OK，则设置系统定时任务（界面操作略），定时到服务器端备份确定完成的时间进行增量远程备份。</p>
<blockquote>
<p>以下脚本，我默认防止到cwRsync的安装目录。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">SET CYGWIN=tty</span><br><span class="line"><span class="built_in">set</span> curdir=%~dp0</span><br><span class="line"><span class="built_in">cd</span> /d %curdir%</span><br><span class="line"><span class="built_in">set</span> CWRSYNC_HOME=%curdir%</span><br><span class="line"><span class="built_in">echo</span> %DATE:~0,4%-%DATE:~5,2%-%DATE:~8,2%%TIME:~0,2%:%TIME:~3,2%:%TIME:~6,2% [INFO] start backup svn from svn-server with rsync</span><br><span class="line"><span class="built_in">echo</span> %DATE:~0,4%-%DATE:~5,2%-%DATE:~8,2%%TIME:~0,2%:%TIME:~3,2%:%TIME:~6,2% [INFO] CWRSYNC_HOME=%CWRSYNC_HOME%</span><br><span class="line">%CWRSYNC_HOME%/bin/rsync -vzrtopg --progress --delete root@111.111.111.111::svn /cygdrive/e/backup/svn --password-file=rsyncd.secrets</span><br><span class="line"><span class="built_in">echo</span> %DATE:~0,4%-%DATE:~5,2%-%DATE:~8,2%%TIME:~0,2%:%TIME:~3,2%:%TIME:~6,2% [INFO] backup finished!</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>
<h3 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h3><p>因为备份采用的是hotcopy，直接新建一个SVN服务器，拷贝备份的svn仓库到新服务器的仓库目录即可。</p>
<blockquote>
<p>如果新服务器的版本与备份的svn服务器软件版本不一致，则比较麻烦，可以在另外的环境随便搭建一个与备份相同版本的svn服务器，导入后，采用svnadmin dump默认导出仓库备份文件后，在通过该文件在新svn服务中恢复~</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/2016-01-25-svn也可以github-pages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/2016-01-25-svn也可以github-pages/" itemprop="url">svn也可以github-pages</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:14:17+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>現在也可以大量在使用git，在github上也用pages搭建了自家的博客网站，但是目前很多项目或公司主流还是svn，今天想，目前很多移动项目都需要API文档展示（已解决代码自动生成文档问题），目前每次都手动生成，手动发布，麻烦哦~，是否也可以为svn简单弄个Page?!，想了下貌似可以，do it！~ 下面的是实操的记录。</p>
<h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><ul>
<li>约定工程目录下src/main/site目录为项目网站的内容目录，暂时考虑静态本地生成（主要是已有了API文档自动生成），区别github的做法，没有用pages名称的专用分支，直接规定一个自目录，效果一样。</li>
<li>通过SVN服务仓库的hooks的post-commit，拦截每次工程代码提交，如果是src/main/site目录下的文件变动（新增，删除，修改等），则启动自动发布该项目网站的脚本自动发布最新的项目网站（后面统一交site）</li>
<li>自动发布脚本判断规定的发布目录是否存在，同时是否已有该项目site的checkout版本，如果无，则checkout，否则up。</li>
<li>使用nginx映射所有自动生成的项目网站的父目录（project）,同时使用baisc认证简单控制安全, 账户正好直接使用svn的账户（passwd文件格式本来就相同），项目成员本来就有SVN账户，正合适~~</li>
</ul>
<p><strong>以上方案实现了： 开发人员线下弄好网站，提交到SVN就自动发布到项目网站，并具有安全认证。</strong></p>
<p>后续计划：</p>
<p>（有空就弄,没空就算了，已上已解决90%的问题）</p>
<ul>
<li>支持markdown文件提交后，自动转换或展示html。这个可以满足手动编写的一些文档的方便发布</li>
<li>openApi文档部分不用线下手动生成，只要开发提交了openApi服务，则制动生成并发布到项目网站。</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>我的svn服务的搭建方案为：nginx+apache+svn,如有兴趣请参考：<a href="/linux/linux实用svn服务器.html">linux实用svn服务器</a>。下面的配置以此环境为例。</p>
<p>我需要控制的svn仓库是project目录（svn顶层目录，也就是仓库），我是在project下建立子目录作为真是的项目工程仓库，所以，我只需要控制project这个仓库就够了。</p>
<h4 id="SVN-hooks配置"><a href="#SVN-hooks配置" class="headerlink" title="SVN hooks配置"></a>SVN hooks配置</h4><p>首先，我要做的是编写一个脚本（svn_site_deploy.sh）,实现根据svn的hooks参数（一般两个，仓库地址和版本号/事务号），获取本次提交的changed,如果变动文件中存在src/main/site路径的文件，则启动自动发布site到指定配置的目录。发布的策略为发布的目标目录如果存在checkou拷贝，则up,否则checkout。以下是脚本代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">svn_bin=/usr/bin</span><br><span class="line">svn_server=http://ip/svn</span><br><span class="line">svn_user=deployer</span><br><span class="line">svn_pswd=***********</span><br><span class="line">site_home=/opt/www/project</span><br><span class="line">repos=<span class="variable">$1</span></span><br><span class="line">rev=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;repos&#125;</span>"</span> == <span class="string">""</span> ] || [ <span class="string">"<span class="variable">$&#123;rev&#125;</span>"</span> == <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exit</span> 0;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">site_subdir=/src/main/site</span><br><span class="line">repos_name=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$repos</span>"</span> | awk -F <span class="string">"/"</span> <span class="string">'&#123;print $NF&#125;'</span>`</span><br><span class="line">site_changed=`<span class="variable">$svn_bin</span>/svnlook changed -r <span class="variable">$rev</span> <span class="variable">$repos</span> |grep <span class="string">"<span class="variable">$site_subdir</span>"</span>`</span><br><span class="line"><span class="keyword">if</span> [  <span class="string">"<span class="variable">$site_changed</span>"</span> == <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">change_path=`<span class="variable">$svn_bin</span>/svnlook changed -r <span class="variable">$rev</span> <span class="variable">$repos</span> |head -1| awk -F <span class="string">" "</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">project_name=<span class="variable">$&#123;change_path%/trunk/*&#125;</span></span><br><span class="line">repos_path=<span class="variable">$repos_name</span></span><br><span class="line">site_path=<span class="variable">$site_home</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$project_name</span>"</span> != <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">  repos_path=<span class="variable">$repos_path</span>/<span class="variable">$project_name</span></span><br><span class="line">  site_path=<span class="variable">$site_path</span>/<span class="variable">$project_name</span>  </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"repos_path: "</span><span class="variable">$repos_path</span></span><br><span class="line">site_url=<span class="variable">$svn_server</span>/<span class="variable">$repos_path</span>/trunk<span class="variable">$site_subdir</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># "`$svn_bin/svn info $repos_site |grep $repos`" != ""</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$site_path</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># 存在，update</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$svn_bin</span>/svn update <span class="variable">$site_path</span> &gt;&gt; /data/svn/op/hooks/<span class="built_in">log</span></span><br><span class="line">  <span class="variable">$svn_bin</span>/svn update <span class="variable">$site_path</span> &gt;&gt; /data/svn/op/hooks/<span class="built_in">log</span></span><br><span class="line">  <span class="built_in">echo</span> update finished. &gt;&gt; /data/svn/op/hooks/<span class="built_in">log</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># 不存在，checkout</span></span><br><span class="line">  mkdir -p <span class="variable">$site_path</span></span><br><span class="line">  rm -fr <span class="variable">$site_path</span>/*</span><br><span class="line">  <span class="variable">$svn_bin</span>/svn checkout <span class="variable">$site_url</span> <span class="variable">$site_path</span> --username <span class="variable">$svn_user</span> --password <span class="variable">$svn_pswd</span></span><br><span class="line">  <span class="built_in">echo</span> checkout finished. &gt;&gt; /data/svn/op/hooks/<span class="built_in">log</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里特别说明下：<br>脚本是通过svn的post-commit提交的，也就是说，每次提交后执行，那么传入参数$1代表被操作的仓库地址（如:/data/svn/project）；$2则表示本次提交的修订版本号(revision),如果是pre-commit,$2表示的是事务号（transcation,因为还没有提交版本，算事务）</p>
</blockquote>
<p>然后，进入到需要控制的仓库project的hooks目录，新建一个post-commit文件，写入调用上面的svn_site_deploy.sh脚本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/svn/project/hooks</span><br><span class="line">touch post-commit</span><br><span class="line">cp /opt/tools/svn_site_deploy.sh ./</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/data/svn/project/hooks/svn_site_deploy.sh"</span></span><br><span class="line"><span class="comment">## 非常重要和关键的一点，这里要属主文件为svn的运行用户，否则脚本无法正常执行。</span></span><br><span class="line">chown apache:apache post-commit</span><br><span class="line">chmod +x post-commit</span><br><span class="line">chown apache:apache svn_site_deploy</span><br><span class="line">chmod +x svn_site_deploy</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重要的事情，再说一遍：<br>所有脚本的属主需要设置为svn的运行用户，否则脚本无法正常执行，同时目标发布目录也需要为这个用户设置写入权限。</p>
</blockquote>
<p>OK,配置完成了</p>
<h4 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h4><p>前面已通过svn的hooks+自定义脚本完成了自动发布到WEB目录，前端已可以正常浏览访问了，但是项目的文档和API有时候是比较私密的，不会对公网直接发布，所以考虑采用basic认证方式保证安全，账户服用SVN的账户，因为它本来就存在~</p>
<p>打开ngnix的主配置文件，加入：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location /project/ &#123;</span><br><span class="line">	root /opt/www;</span><br><span class="line">	index  index.html index.htm;</span><br><span class="line">	auth_basic "Project Dev Portal &lt;SVN Account&gt;";</span><br><span class="line">	auth_basic_user_file /data/svn/passwd;</span><br><span class="line">	autoindex on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存退出后，reload下ngnix就OK~~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/服务应用/2016-03-1-linux实用openfire安装配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/服务应用/2016-03-1-linux实用openfire安装配置/" itemprop="url">linux实用openfire安装配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:14:09+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文主要是我在某项目中集成openfire服务，用于支撑多终端互动聊天功能。包括：web，android，iphone互通聊天。同时扩展第三发聊天记录插件，开发并部署openfire插件提供借口方式访问用户聊天记录的能力。</p>
<h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><h4 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h4><ul>
<li>Openfire v3.9.3 下载（高版本也可以，如果要本版本请百度）：<a href="http://www.igniterealtime.org/downloads/index.jsp" target="_blank" rel="noopener">官方下载</a></li>
<li>CentOS 6.x(3-7) x64</li>
<li>Oracle JDK 1.7</li>
</ul>
<h4 id="Openfire安装"><a href="#Openfire安装" class="headerlink" title="Openfire安装"></a>Openfire安装</h4><p>CentOs的安装这里忽略，本案例实用aliyun, JDK的安装和环境变量配置，这里也忽略。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://....</span><br><span class="line">$ tar -xzvf openfire_3_9_3.tar.gz</span><br><span class="line">$ cp openfire /opt/</span><br><span class="line">$ <span class="built_in">cd</span> /opt/openfire/bin</span><br><span class="line">$ ./openfire start</span><br></pre></td></tr></table></figure>
<p>安装完成并启动后，可以在浏览器输入<a href="http://ip:9090进入到默认管理配置界面。" target="_blank" rel="noopener">http://ip:9090进入到默认管理配置界面。</a></p>
<blockquote>
<p>注意：openfire使用的端口9090-9091,7070-7071还有5050都需要先预留和打通。</p>
</blockquote>
<h4 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h4><p>略。可参考：<a href="http://blog.acooly.cn/linux/linux_mysql.html" target="_blank" rel="noopener">CentOS6.x (Linux)MySQL安装配置</a></p>
<blockquote>
<p>注意：安装完成数据库后，需要创建一个空的数据库，用于Openfire使用，这里采用同机部署的MySQL。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`openfire`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span></span><br></pre></td></tr></table></figure>
<h4 id="Openfire配置"><a href="#Openfire配置" class="headerlink" title="Openfire配置"></a>Openfire配置</h4><p>正常情况下，安装完成openfire和数据库后，我们可以进行openfire的配置。</p>
<h5 id="初始化Openfire"><a href="#初始化Openfire" class="headerlink" title="初始化Openfire"></a>初始化Openfire</h5><ol>
<li><p>浏览器直接方式服务的9090端口，开始初始化配置如下<br><br><a href="/resources/images/openfire/init_1.png"><br> <img src="/resources/images/openfire/init_1.png" style="width:668px"><br></a></p>
</li>
<li><p>选择和配置数据库<br><br><img src="/resources/images/openfire/init_2.png" alt="选择数据库"><br><br><img src="/resources/images/openfire/init_3.png" alt="配置数据库"></p>
<blockquote>
<p>注意：这里谨慎选择域（访问域名），这个后续会作为客户端访问的域和地址。</p>
</blockquote>
</li>
<li><p>设置管理员密码<br><br><img src="/resources/images/openfire/init_4.png" alt="设置密码"></p>
</li>
</ol>
<h5 id="修改域名"><a href="#修改域名" class="headerlink" title="修改域名"></a>修改域名</h5>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2016/11/21/java/2015-12-14-java tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/java/2015-12-14-java tools/" itemprop="url">Java常用命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T00:12:34+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>* jvisualvm
</code></pre><p>jvm的运行情况/各种dump的分析都可以干,没有JRMC牛.oracle承诺会把JRockit的特性迁移到HotSpot上面来.现在jdk下已经有jmc了.</p>
<pre><code>* jps -lv
</code></pre><p>查看所有java进程.</p>
<pre><code>* jinfo -sysprops pid
</code></pre><p>查看java进程系统参数</p>
<pre><code>* jmap -dump:file=xxx.map pid
</code></pre><p>生成heap dump</p>
<pre><code>* java -XX:+UnlockDiagnosticVMOptions -XX:+PrintFlagsFinal
</code></pre><p>查看jvm flag<br>     The first column appears to reflect the data type of the option (intx, uintx, uint64_t, bool, double, ccstr, ccstrlist).<br>        The second column is the name of the flag and the third column is the value, if any, that the flag is set to.<br>        The fourth column appears to indicate the type of flag and has values such as {product},{pd product}, {C1 product} for client or {C2 product} for server, {C1 pd product} for client or {C2 pd product} for server, {product rw}, {diagnostic}<br>        (only if -XX:+UnlockDiagnosticVMOptions was specified), {experimental}, and {manageable}. See Eugene Kuleshov’s The most complete list of -XX options for Java 6 JVM for a brief description of most of these categories as well as a listing of most of these options themselves.</p>
<pre><code>* tda
</code></pre><p>线程栈分析器,这个是jvisualvm的插件.</p>
<p>jstack -F 32172 | grep Thread |grep state -wc</p>
<pre><code>* mat
</code></pre><p>基于eclipse的heap dump分析工具,这个工具是比jvisualvm在heap分析这块专业.不过jvisualvm能cover住大多数场景,基本上我都只用jvisualvm了.</p>
<pre><code>* jmap -heap pid
</code></pre><p>检查heap情况</p>
<pre><code>* GCViewer
</code></pre><p>GC日志分析</p>
<pre><code>* jstat -gcutil pid
</code></pre><p>查看gc总体情况<br>     S0  — Heap上的 Survivor space 0 区已使用空间的百分比<br>        S1  — Heap上的 Survivor space 1 区已使用空间的百分比<br>        E   — Heap上的 Eden space 区已使用空间的百分比<br>        O   — Heap上的 Old space 区已使用空间的百分比<br>        P   — Perm space 区已使用空间的百分比<br>        YGC — 从应用程序启动到采样时发生 Young GC 的次数<br>        YGCT– 从应用程序启动到采样时 Young GC 所用的时间(单位秒)<br>        FGC — 从应用程序启动到采样时发生 Full GC 的次数<br>        FGCT– 从应用程序启动到采样时 Full GC 所用的时间(单位秒)<br>        GCT — 从应用程序启动到采样时用于垃圾回收的总时间(单位秒)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpeg"
                alt="zhang pu" />
            
              <p class="site-author-name" itemprop="name">zhang pu</p>
              <p class="site-description motion-element" itemprop="description">本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://bohr.me/" title="qiubo's life" target="_blank">qiubo's life</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.1119e.com/" title="投资1119e" target="_blank">投资1119e</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.pccb.com" title="普资金服" target="_blank">普资金服</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhang pu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
