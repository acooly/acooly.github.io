<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事">
<meta property="og:type" content="website">
<meta property="og:title" content="Acooly&#39;s Blog">
<meta property="og:url" content="http://acooly.github.io/index.html">
<meta property="og:site_name" content="Acooly&#39;s Blog">
<meta property="og:description" content="本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Acooly&#39;s Blog">
<meta name="twitter:description" content="本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://acooly.github.io/"/>





  <title>Acooly's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Acooly's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">coder live</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2018/04/01/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/01/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-01T20:37:26+08:00">
                2018-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/09/18/acooly/2016-06-07-acooly-guide-boss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/18/acooly/2016-06-07-acooly-guide-boss/" itemprop="url">acooly框架-BOSS开发指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-18T14:57:14+08:00">
                2017-09-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/acooly开发框架/" itemprop="url" rel="index">
                    <span itemprop="name">acooly开发框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <style>img {max-width:100%;}</style>

<p>管理视图的开发在acooly框架下，我们选择的是easyui作为基本的前端解决方案，采用JSP作为视图渲染。</p>
<blockquote>
<p>本章节，先总体描述后台管理的easyui开发的一些约定，注意点，然后在列举最几种常用的视图开发场景的案例。</p>
</blockquote>
<h1 id="基础知识准备"><a href="#基础知识准备" class="headerlink" title="基础知识准备"></a>基础知识准备</h1><p>如果需要进行acooly框架的后台管理功能开发，需要进行一些基础技术栈的准备。</p>
<ul>
<li>html：熟悉HTML语法</li>
<li>javascript：要求至少能阅读常规代码，编写基本的表单验证功能。</li>
<li>jquery：熟悉常规的jquery操作，包括：选择器，ajax的语法和异常处理。</li>
<li>easyui：至少熟悉：布局管理（easyui-layout），表格（easyui-datagrid），弹出框（dialog），按钮（easyui-linkbutton）等</li>
<li>jsp/jstl/freemarker: 至少熟悉：servlet内置变量的操作，自定义变量输出，Map和List的跌倒，if控制语句等。</li>
</ul>
<h1 id="开发规范和约定"><a href="#开发规范和约定" class="headerlink" title="开发规范和约定"></a>开发规范和约定</h1><h2 id="元素ID全局唯一"><a href="#元素ID全局唯一" class="headerlink" title="元素ID全局唯一"></a>元素ID全局唯一</h2><p>所有后台的界面采用EASYUI搭建，每个模块功能页面默认采用AJAX方式加载，JS运行SCOPE是唯一的，要求整站的所有页面的所有元素的ID唯一，否则可能出现不可预料的问题。</p>
<p>命名规则为：manage_模块名称(一般为受托管的实体名称)_UI组件名称_其他</p>
<p>如：manage_customer_datagrid , manage_customer_form,manage_customer_searchform, manage_customer_button_search</p>
<h2 id="基本操作模式"><a href="#基本操作模式" class="headerlink" title="基本操作模式"></a>基本操作模式</h2><p>所有后台功能模块的基本操作模式都是采用：主界面 + 弹出框操作模式，主界面一般为列表(datagrid),也可以是多个datagrid与其他UI组件的整合，如果左右，上下结构，与zTree,Tab等组件的组合等。</p>
<p>功能包括：独立的多条件查询区域，独立的横向工具条，表格内每行的功能按钮等。</p>
<h1 id="封装功能介绍"><a href="#封装功能介绍" class="headerlink" title="封装功能介绍"></a>封装功能介绍</h1><p>acooly框架的后台基于easyui，在开发规范和约定的基础上，做了较多的基础功能封装。</p>
<h2 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h2><p>常规操作的封装主要包括: 操作的CRUD，查询，上传，下载等通用功能，同时提供非界面的确认操作模式封装。操作的封装主要在:</p>
<ul>
<li>/manage/assert/script/acooly.framework.js</li>
<li>/manage/assert/script/acooly.format.js</li>
<li>/manage/assert/script/acooly.verify.js</li>
</ul>
<p>你可以在运行时，通过查看页面源代码方式找到源代码，也可以acooly-components-security-${version}.jar中找到源代码文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.acooly<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>acooly-components-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;acooly.components.security&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：常规操作完整Demo是以自动代码生成的单模块功能，一个完整模块的功能几乎使用了大部分的常规操作封装。常规操作中的一些API因历史版本原因，虽然不是完善和优美的封装，但是暂时都没有改进或删除冗余，但都可以作为案例参考，使用者可以编写自己的封装函数使用。</p>
</blockquote>
<h3 id="添加和修改"><a href="#添加和修改" class="headerlink" title="添加和修改"></a>添加和修改</h3><p>提供统一的弹出dialog调用指定URL（create或edit）获取添加和编辑的视图，并在弹出框中显示，同时提供统一的按钮（提交）和(取消)，封装提交的表单请求，完成添加和编辑的保持操作。</p>
<p><strong>$.acooly.framework.create(opts)<br>$.acooly.framework.edit(opts)</strong></p>
<p>opts参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>添加或编辑视图地址(必填)</td>
</tr>
<tr>
<td>form</td>
<td>string</td>
<td>否</td>
<td>添加和编辑的form表单ID（可选，如果传入entity参数，则可以不填写）</td>
</tr>
<tr>
<td>datagrid</td>
<td>string</td>
<td>否</td>
<td>列表视图datagrid组件ID（可选，如果传入entity参数，则可以不填写）</td>
</tr>
<tr>
<td>entity</td>
<td>string</td>
<td>否</td>
<td>添加和编辑的实体类名称首字母小写(可选，代替：form和datagrid)</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>否</td>
<td>标题，默认为：添加或修改</td>
</tr>
<tr>
<td>top</td>
<td>int</td>
<td>否</td>
<td>位置top，默认居中的top</td>
</tr>
<tr>
<td>width</td>
<td>int</td>
<td>否</td>
<td>宽度，默认：500px</td>
</tr>
<tr>
<td>height</td>
<td>int</td>
<td>否</td>
<td>高度，默认：auto，根据类型显示</td>
</tr>
<tr>
<td>submitButton</td>
<td>string</td>
<td>否</td>
<td>提交按钮的label，默认：增加或修改</td>
</tr>
<tr>
<td>reload</td>
<td>boolean</td>
<td>否</td>
<td>提交成功后，是否reload列表datagrid,如果为true，则提交成功后重新load列表数据，如果为false(默认)，动态插入新数据（添加）或更新（编辑）datagrid对应的行。</td>
</tr>
<tr>
<td>maximizable</td>
<td>boolean</td>
<td>否</td>
<td>弹出框是否可以最大化，true或false(默认)</td>
</tr>
<tr>
<td>onSubmit</td>
<td>function</td>
<td>否</td>
<td>表单提交前，在原有easyui表单验证前的拦截函数，可以在本函数中进行附加的提交前验证和对表单元素赋值操作。如果返回false，则终止提交。无传入参数，可以通过jquery选择器获取当前scope的元素值。</td>
</tr>
<tr>
<td>onSuccess</td>
<td>function</td>
<td>否</td>
<td>提交成功后的回调函数（result.success = true），传入参数为ajax表单提交的返回值（一般为JsonEntityResult的Json数据）。</td>
</tr>
<tr>
<td>onFaillure</td>
<td>function</td>
<td>否</td>
<td>提交失败后回调函数（result.success = false），传入参数为ajax表单提交的返回值（一般为JsonEntityResult的Json数据）。</td>
</tr>
<tr>
<td>onClose</td>
<td>function</td>
<td>否</td>
<td>关闭弹出框回调函数</td>
</tr>
<tr>
<td>ajaxData</td>
<td>json</td>
<td>否</td>
<td>可以传递添加和编辑视图额外的请求参数。如{“search_EQ_id”:1}</td>
</tr>
<tr>
<td>buttons</td>
<td>array</td>
<td>否</td>
<td>可增加按钮。格式：{id:xx,text:xxx,hander:function(){…}}</td>
</tr>
</tbody>
</table>
<blockquote>
<p>框架最初为提供添加和删除的相关回调函数，采用命名约定的隐含回调函数方式处理。处理方式都是在添加或编辑的视图界面中，声明指定名称的函数实现回调。包括：<br>${formId}_beforeSubmit：表示表单序列化完成后，提交前的拦截函数。<br>${formId}_onSubmit：同onSubmit</p>
</blockquote>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定视图URL，实体名，高度，宽度等</span></span><br><span class="line">$.acooly.framework.create(&#123;<span class="attr">url</span>:<span class="string">'/manage/showcase/customer/create.html'</span>,<span class="attr">entity</span>:<span class="string">'customer'</span>,<span class="attr">width</span>:<span class="number">500</span>,<span class="attr">height</span>:<span class="number">400</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增加特殊按钮</span></span><br><span class="line">$.acooly.framework.create(&#123;</span><br><span class="line">    url:<span class="string">'/manage/module/app/app/create.html'</span>,</span><br><span class="line">    entity:<span class="string">'app'</span>,</span><br><span class="line">    width:<span class="number">500</span>,<span class="attr">height</span>:<span class="number">400</span>,</span><br><span class="line">    hideSaveBtn:<span class="literal">true</span>,</span><br><span class="line">    buttons:[&#123;</span><br><span class="line">            id:<span class="string">"manage_app_btn_ok"</span>,</span><br><span class="line">            text:<span class="string">"&lt;i class=\"fa fa-book fa-lg fa-fw fa-col\"&gt;&lt;/i&gt;审批通过"</span>,</span><br><span class="line">            handler:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 获取按钮当前ID</span></span><br><span class="line">                <span class="built_in">console</span>.info($(<span class="keyword">this</span>).attr(<span class="string">'id'</span>));</span><br><span class="line">                $.messager.alert(<span class="string">'提示'</span>, <span class="string">"这个审批按钮，这里可以通过JS操作表单的值，然后再调用ajaxSubmitHander提交表单，行为与原来的提交表单一致"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// do something. eg: change action url; change form-field value.</span></span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 提交表单（create or edit）,前4个参数必选。</span></span><br><span class="line">                $.acooly.framework.ajaxSubmitHandler(<span class="string">"create"</span>,$(<span class="keyword">this</span>),<span class="string">"manage_app_editform"</span>,<span class="string">"manage_app_datagrid"</span>, <span class="literal">true</span>,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                      <span class="comment">// onSubmit: before submit</span></span><br><span class="line">                        <span class="built_in">console</span>.info(<span class="string">"onsubmit"</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                        <span class="comment">// onSuccess</span></span><br><span class="line">                        <span class="built_in">console</span>.info(<span class="string">"onSuccess"</span>);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        <span class="comment">// onFailure</span></span><br><span class="line">                        <span class="built_in">console</span>.info(<span class="string">"onFailure"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            id:<span class="string">"manage_app_btn_no"</span>,</span><br><span class="line">            text:<span class="string">"&lt;i class=\"fa fa-book fa-lg fa-fw fa-col\"&gt;&lt;/i&gt;审批驳回"</span>,</span><br><span class="line">            handler:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                $.acooly.framework.ajaxSubmitHandler(<span class="string">"create"</span>,$(<span class="keyword">this</span>),<span class="string">"manage_app_editform"</span>,<span class="string">"manage_app_datagrid"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="通用表单查询"><a href="#通用表单查询" class="headerlink" title="通用表单查询"></a>通用表单查询</h3><p>提供统一的的通用表单查询封装，特性如下：</p>
<ol>
<li>自动序列化指定元素ID（可以是formId,也可以是任意的DIV的ID）下的所有表单为json格式，作为查询条件。</li>
<li>查询完成后，获取的新数据，自动reload制定的表格数据（datagrid）</li>
<li>自动注册查询表单的回传按键为提交查询</li>
</ol>
<p><strong>$.acooly.framework.search(containerId,datagridId);</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>containerId</td>
<td>string</td>
<td>是</td>
<td>formId,也可以是任意的DIV的ID</td>
</tr>
<tr>
<td>datagridId</td>
<td>string</td>
<td>是</td>
<td>显示查询结果的datagrid</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.search(<span class="string">'manage_customer_searchform'</span>,<span class="string">'manage_customer_datagrid'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0);"</span> <span class="attr">class</span>=<span class="string">"easyui-linkbutton"</span> <span class="attr">data-options</span>=<span class="string">"plain:false"</span> <span class="attr">onclick</span>=<span class="string">"$.acooly.framework.search('manage_customer_searchform','manage_customer_datagrid');"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-search fa-lg fa-fw fa-col"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表单回传自动提交查询：<br>$.acooly.framework.registerKeydown(containerId,datagridId)</p>
<p>该方法需要在查询界面初始化时调用。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.acooly.framework.registerKeydown(<span class="string">'manage_customer_searchform'</span>,<span class="string">'manage_customer_datagrid'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><p>提供通用弹出框查询视图界面封装。</p>
<p><strong>$.acooly.framework.show(url, width, height)<br>$.acooly.framework.get(opts)</strong></p>
<p>opts参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>视图的URL</td>
</tr>
<tr>
<td>width</td>
<td>int</td>
<td>否</td>
<td>宽度，默认:400px</td>
</tr>
<tr>
<td>height</td>
<td>int</td>
<td>否</td>
<td>高度，默认：300px</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>否</td>
<td>弹出框标题，默认为：查看</td>
</tr>
</tbody>
</table>
<p>get与show是不同时期的封装，为兼容老版本，所以同时支持，不同在于，get可以指定弹出框的标题，推荐使用get</p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>提供通用的删除功能封装，支持单个和批量，同时删除前二次确认。</p>
<p><strong>删除单条</strong><br>对制定id的数据提供删除功能，url,id和datagrid为必选。</p>
<p><strong>$.acooly.framework.remove(url, id, datagrid, confirmTitle, confirmMessage)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.remove(<span class="string">'/manage/showcase/customer/deleteJson.html'</span>,<span class="string">'1'</span>,<span class="string">'manage_customer_datagrid'</span>);</span><br></pre></td></tr></table></figure>
<p><strong>批量删除</strong><br>批量删除提供对datagrid选择的行批量删除的功能，url和datagrid为必选。</p>
<p><strong>$.acooly.framework.removes(url, datagrid, confirmTitle, confirmMessage)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.removes(<span class="string">'/manage/showcase/customer/deleteJson.html'</span>,<span class="string">'manage_customer_datagrid'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="导出文件"><a href="#导出文件" class="headerlink" title="导出文件"></a>导出文件</h3><p>提供以当前查询表单所选作为条件的动态查询后导出EXCEL和CSV的功能。可以指定导出文件名。</p>
<p><strong>$.acooly.framework.exports(url, searchForm, fileName);</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>文件下载的URL，EXCEL和CSV有不同的URL</td>
</tr>
<tr>
<td>searchForm</td>
<td>string</td>
<td>是</td>
<td>查询的表单的父元素ID</td>
</tr>
<tr>
<td>fileName</td>
<td>string</td>
<td>否</td>
<td>下载的文件名，默认为服务器端指定。</td>
</tr>
</tbody>
</table>
<p>实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出EXCEL</span></span><br><span class="line">$.acooly.framework.exports(<span class="string">'/manage/showcase/customer/exportXls.html'</span>,<span class="string">'manage_customer_searchform'</span>,<span class="string">'客户信息表'</span>)<span class="string">"</span></span><br><span class="line"><span class="string">// 导出CSV</span></span><br><span class="line"><span class="string">$.acooly.framework.exports('/manage/showcase/customer/exportCsv.html','manage_customer_searchform','客户信息表')</span></span><br></pre></td></tr></table></figure>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>提供通用的文件上传功能，也可以作为文件导入的界面使用。</p>
<p><strong>$.acooly.framework.createUploadify(opts);</strong></p>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>文件上传的URL</td>
</tr>
<tr>
<td>formData</td>
<td>json</td>
<td>否</td>
<td>POST提交的表单数据</td>
</tr>
<tr>
<td>jsessionid</td>
<td>string</td>
<td>是</td>
<td>因为采用的是第三方组件，无法直接使用cookie,需要通过URL传递sessionid，jsp可传入：&lt;%=request.getSession().getId()%&gt;。</td>
</tr>
<tr>
<td>messager</td>
<td>string</td>
<td>是</td>
<td>上传的过程消息显示label元素ID</td>
</tr>
<tr>
<td>uploader</td>
<td>string</td>
<td>是</td>
<td>上传组件的唯一ID</td>
</tr>
</tbody>
</table>
<p>实例：</p>
<p>请参考自动代码生成的数据导入视图。{entity}Import.jsp</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.createUploadify(&#123;</span><br><span class="line">	<span class="comment">/** 上传导入的URL */</span></span><br><span class="line">	url:<span class="string">'/manage/showcase/customer/importJson.html?_csrf=$&#123;requestScope["org.springframework.security.web.csrf.CsrfToken"].token&#125;&amp;splitKey=v'</span>,</span><br><span class="line">	<span class="comment">/** 导入操作消息容器 */</span></span><br><span class="line">	messager:<span class="string">'manage_customer_import_uploader_message'</span>,</span><br><span class="line">	<span class="comment">/** 上传导入文件表单ID */</span></span><br><span class="line">	uploader:<span class="string">'manage_customer_import_uploader_file'</span>,</span><br><span class="line">	jsessionid:<span class="string">'&lt;%=request.getSession().getId()%&gt;'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="通用询问请求操作"><a href="#通用询问请求操作" class="headerlink" title="通用询问请求操作"></a>通用询问请求操作</h3><p>前端管理功能开发中，存在很多无界面的询问二次确认的请求操作，场景为：点击按钮(或其他)触发，询问二次确认，确定后，请求服务器端一个指定URL，待服务器端完成操作后，提供操作结果。一般应用于在datagrid中选择了行后的对应操作，如：禁用，启用，移动等。</p>
<p><strong>$.acooly.framework.confirmRequest(url, requestData, datagrid, confirmTitle, confirmMessage, onSuccess, onFailure)</strong></p>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>操作的URL</td>
</tr>
<tr>
<td>requestData</td>
<td>json</td>
<td>否</td>
<td>POST请求的数据</td>
</tr>
<tr>
<td>datagrid</td>
<td>string</td>
<td>是</td>
<td>完成请求后，需要刷新的列表</td>
</tr>
<tr>
<td>confirmTitle</td>
<td>string</td>
<td>否</td>
<td>确认框标题，默认：确定</td>
</tr>
<tr>
<td>confirmMessage</td>
<td>string</td>
<td>否</td>
<td>确认框提示文字，默认：您是否要提交该操作？</td>
</tr>
<tr>
<td>onSuccess</td>
<td>function</td>
<td>否</td>
<td>提交成功后的回调函数（result.success = true），传入参数为ajax表单提交的返回值（一般为JsonResult的Json数据）。</td>
</tr>
<tr>
<td>onFailure</td>
<td>function</td>
<td>否</td>
<td>提交成功后的回调函数（result.success = false），传入参数为ajax表单提交的返回值（一般为JsonResult的Json数据）</td>
</tr>
</tbody>
</table>
<h3 id="工具方法"><a href="#工具方法" class="headerlink" title="工具方法"></a>工具方法</h3><h4 id="获取选中的Grid行"><a href="#获取选中的Grid行" class="headerlink" title="获取选中的Grid行"></a>获取选中的Grid行</h4><p>提供了通用的选择Datagrid行的帮助方法，返回为当前选择行的对应数据. 同时支持datagrid和treegrid</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.getSelectedRow(datagrid);</span><br></pre></td></tr></table></figure>
<h4 id="获取选择的Tab索引号"><a href="#获取选择的Tab索引号" class="headerlink" title="获取选择的Tab索引号"></a>获取选择的Tab索引号</h4><p>该方法一般用于判断当前选择了那个Tab，然后可以通过tab的onSelect事件绑定来协同处理选中某个tab后的操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.getSelectedTabIndex(tabsId);</span><br></pre></td></tr></table></figure>
<h4 id="Grid行选择事件触发"><a href="#Grid行选择事件触发" class="headerlink" title="Grid行选择事件触发"></a>Grid行选择事件触发</h4><p>用于触发选中Datagrid的行后的回调操作。选中grid的行，如果未选择则提示错误，否则回调传入的函数逻辑。一般用于必须选择了某行采用进行后续操作逻辑的处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.fireSelectRow(gridId, selectedCallBack, errorMessage)</span><br></pre></td></tr></table></figure>
<h4 id="手动加载Grid"><a href="#手动加载Grid" class="headerlink" title="手动加载Grid"></a>手动加载Grid</h4><p>一般用于特殊场景，需要手动通过ajax获取数据，然后手动加载显示Grid数据的场景。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// opts:gridId,url,ajaxData</span></span><br><span class="line">$.acooly.framework.loadGrid(opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新加载（刷新）</span></span><br><span class="line">$.acooly.framework.reloadGrid(gridId)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：为防止重复加载，可以预先设置datagrid为不可显示，同时不要设置datagrid的url对象，在加载完成后，在渲染和显示datagrid。</p>
</blockquote>
<h1 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h1><h2 id="DataGrid"><a href="#DataGrid" class="headerlink" title="DataGrid"></a>DataGrid</h2><p>EasyUI的DataGrid组件是BOSS后台最常用的组件，没有之一，就是最常用的。数据查询，数据管理首页等。本节主要针对acooly框架对DataGrid的使用和扩展进行说明，DataGrid本身的大量功能和特性请参考EASYUI官方文档和Demo。</p>
<blockquote>
<p>EasyUI的DataGrid：<a href="http://www.jeasyui.com/documentation/index.php" target="_blank">文档</a>和<a href="http://www.jeasyui.com/demo/main/index.php?plugin=DataGrid&theme=default&dir=ltr&pitem=" target="_blank">Demo</a></p>
</blockquote>
<p>建议代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"manage_customer_datagrid"</span> <span class="attr">class</span>=<span class="string">"easyui-datagrid"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">url</span>=<span class="string">"/manage/showcase/customer/listJson.html"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">toolbar</span>=<span class="string">"#manage_customer_toolbar"</span> <span class="attr">fit</span>=<span class="string">"true"</span> <span class="attr">border</span>=<span class="string">"false"</span> <span class="attr">fitColumns</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pagination</span>=<span class="string">"true"</span> <span class="attr">idField</span>=<span class="string">"id"</span> <span class="attr">pageSize</span>=<span class="string">"20"</span> <span class="attr">pageList</span>=<span class="string">"[ 10, 20, 30, 40, 50 ]"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">sortName</span>=<span class="string">"id"</span> <span class="attr">sortOrder</span>=<span class="string">"desc"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">checkOnSelect</span>=<span class="string">"true"</span> <span class="attr">selectOnCheck</span>=<span class="string">"true"</span> <span class="attr">singleSelect</span>=<span class="string">"true"</span> <span class="attr">nowrap</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"showCheckboxWithId"</span> <span class="attr">checkbox</span>=<span class="string">"true"</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123; return row.id &#125;"</span>&gt;</span>选择<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"id"</span> <span class="attr">sum</span>=<span class="string">"true"</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"username"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span>     </span><br><span class="line">       <span class="comment">&lt;!-- 其他列 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h3><p>acooly框架中，Datagrid的使用方式采用html代码方式，通过标准table标签，添加class=”easyui-datagrid”方式标记为datagrid组件，然后通过属性定义来控制行为。</p>
<p>常用属性说明：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>必选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>是</td>
<td>遵循acooly框架统一的命名约定。</td>
</tr>
<tr>
<td>url</td>
<td>string</td>
<td>否</td>
<td>数据拉取的URL，对应的springMVC方法一定是返回: JsonListResult结构（这里是约定，当然你也可以直接返回一个自定义的JSON结构，只要包含 rows和total两个Datagrid需要的属性即可，但这里不推荐）；特别需要注意，该参数如果填写，则表示视图渲染完成后，会自动访问URL拉去数据，如果遇到需要动态拉取数据的情况，该参数一般先不填写，并设置datagrid为hide，手动加载拉取并渲染后再show.</td>
</tr>
<tr>
<td>toolbar</td>
<td>string</td>
<td>否</td>
<td>指定datagrid的toolbar菜单的元素ID，一般为一组linkbutton的组合，如果没有，则可以不填写该属性。</td>
</tr>
<tr>
<td>fit</td>
<td>boolean</td>
<td>否</td>
<td>表示默认表格最大化填充父元素。</td>
</tr>
<tr>
<td>border</td>
<td>boolean</td>
<td>否</td>
<td>是否显示表格边框</td>
</tr>
<tr>
<td>fitColumns</td>
<td>boolean</td>
<td>否</td>
<td>true/false，表示所有列数据的是否按当前屏幕大小显示，特别重要的属性，如果设置为true，则表示如果列过度操作屏幕横向宽度的情况，不会显示横向滚动条。所以，这里统一建议全部设置为：false</td>
</tr>
<tr>
<td>pagination</td>
<td>boolean</td>
<td>否</td>
<td>是否启用分页功能</td>
</tr>
<tr>
<td>pageSize</td>
<td>int</td>
<td>否</td>
<td>默认分页大小，推荐：20，与服务器端默认值一致</td>
</tr>
<tr>
<td>pageList</td>
<td>array</td>
<td>否</td>
<td>可选分页大小列表。例如：[ 10, 20, 30, 40, 50 ]</td>
</tr>
<tr>
<td>idField</td>
<td>string</td>
<td>是</td>
<td>每行的标志唯一的属性</td>
</tr>
<tr>
<td>sortName</td>
<td>string</td>
<td>否</td>
<td>默认排序的属性名称</td>
</tr>
<tr>
<td>sortOrder</td>
<td>string</td>
<td>否</td>
<td>默认排序方式：desc:降序，ase:升序</td>
</tr>
<tr>
<td>checkOnSelect</td>
<td>boolean</td>
<td>否</td>
<td>表示勾选每行的checkbox后，自动选择本行。</td>
</tr>
<tr>
<td>selectOnCheck</td>
<td>boolean</td>
<td>否</td>
<td>与checkOnSelect的行为类似，并相反。</td>
</tr>
<tr>
<td>singleSelect</td>
<td>boolean</td>
<td>否</td>
<td>是否只允许选择单行。如果无需批量操作（批量删除等）的场景，设置为false.</td>
</tr>
<tr>
<td>nowrap</td>
<td>boolean</td>
<td>否</td>
<td>操作单元格隐藏和显示时，文本是否自动换行。建议这是为false：表示会自动换行。</td>
</tr>
</tbody>
</table>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><p>datagrid官方要求的加载数据的结构为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  total:<span class="number">200</span>,</span><br><span class="line">  rows:[</span><br><span class="line">    &#123;<span class="string">"id"</span>:<span class="number">1</span>, <span class="string">"username"</span>:<span class="string">"zhangpu"</span>,...&#125;,</span><br><span class="line">    &#123;<span class="string">"id"</span>:<span class="number">2</span>, <span class="string">"username"</span>:<span class="string">"alise"</span>,...&#125;,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>acooly框架的数据结构为JsonListResult,增加了success,code,message,和扩展数据data.如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    code: <span class="string">""</span>,</span><br><span class="line">    message: <span class="string">""</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        allIdcardTypes: &#123; <span class="attr">cert</span>: <span class="string">"身份证"</span>, <span class="attr">pass</span>: <span class="string">"护照"</span>,<span class="attr">other</span>: <span class="string">"其他"</span>&#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    total: <span class="number">4</span></span><br><span class="line">    rows: [</span><br><span class="line">        &#123;...&#125;, &#123;...&#125;, &#123;...&#125;, &#123;...&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上数据扩展后，直接加载给datagrid对象，在datagrid组件内的所有列定义的formatter方法内可以直接使用额外传入的Map数据data来作为格式转换。</p>
<h3 id="列定义及格式化"><a href="#列定义及格式化" class="headerlink" title="列定义及格式化"></a>列定义及格式化</h3><p>easyui官方文档对列的定义和属性有全面的说明，请随时跟进需求参考并使用，这里说明的是acooly里面最常用的列定义方式及相关属性和格式化方案。</p>
<p><strong>通用列定义</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"username"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上定义表示：以每个返回实体JSON结构的username这个属性的原始值，名称为：“用户名”。</p>
<p><strong>自定义格式化</strong></p>
<p>datagrid的列格式化，是通过formatter参数提供一个回调函数处理，以函数的返回值作为列的最终输出。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">formatter : <span class="function"><span class="keyword">function</span>(<span class="params">value,row,index</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// value : 当前单元格原始值</span></span><br><span class="line">    <span class="comment">// row : 当前行的json数据，如：&#123;"id":1, "username":"zhangpu",...&#125;</span></span><br><span class="line">    <span class="comment">// index: 当前行在整个datagrid数据集中的位置索引，第1条为0.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意：目前框架对原生的formatter回调函数进行了扩展，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">formatter : <span class="function"><span class="keyword">function</span>(<span class="params">value,row,index,data,field</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// value : 当前单元格原始值</span></span><br><span class="line">    <span class="comment">// row : 当前行的json数据，如：&#123;"id":1, "username":"zhangpu",...&#125;</span></span><br><span class="line">    <span class="comment">// index: 当前行在整个datagrid数据集中的位置索引，第1条为0.</span></span><br><span class="line">    <span class="comment">// data: 当前datagrid的数据，包括分页和附带的其他数据，如：mapping数据。</span></span><br><span class="line">    <span class="comment">// field: 当前单元格的列名。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于以上能力，我们队列的格式化主要有一下几种常见模式：</p>
<ul>
<li><strong>Mapping数据转换</strong>：以服务器端返回的data数据中的mapping，转换原始值为中文。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"gender"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value)&#123; return formatRefrence('manage_customer_datagrid','allGenders',value);&#125; "</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>经过扩展和封装，目前可以写为：</p>
<p>注意：控制层的mapping变量名称必须按约定规则：”all”+首字母大写的列名+”s” ,本例为：allGenders</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.put(<span class="string">"allGenders"</span>,GenderEnum.mapping());</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"gender"</span> <span class="attr">formatter</span>=<span class="string">"mappingFormatter"</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>行操作按钮格式化</strong>：每行的最后一列可以定义为操作列，提供对本行的快捷操作连接按钮，但是一般在点击该类按钮的时候需要传入本行相关的参数，这里需要通过formatter方式构造整个链接及参数，需要使用到js的template,你可以采用任意的第三方js-template，但是默认情况下，acooly框架提供了简单的实现，可以支付几乎所有场景。</p>
<ul>
<li>formatAction方法是老的兼容方法，只实现了对第一个参数（manage_customer_action）指定的元素下的首个{0}替换为当前行的id（row.id）</li>
<li>formatString是推荐的标准模板方法，在第1个参数指定的元素下定义{0-n}的partten,采用后续传入的0-n个参数一一对应的替换。</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"rowActions"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">    return formatAction('manage_customer_action',value,row)</span></span></span><br><span class="line"><span class="tag"><span class="string">&#125;"</span>&gt;</span>动作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"rowActions"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">    return formatString($('#manage_customer_action').html(),row.id);</span></span></span><br><span class="line"><span class="tag"><span class="string">&#125;"</span>&gt;</span>动作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>其他常用格式化封装</li>
</ul>
<table>
<thead>
<tr>
<th>格式化方法</th>
<th>说明</th>
<th>输出样例</th>
</tr>
</thead>
<tbody>
<tr>
<td>moneyFormatter</td>
<td>金额元的formatter，原始值为元</td>
<td>10000.02 -&gt; 10,000.02  </td>
</tr>
<tr>
<td>centMoneyFormatter</td>
<td>金额分格式化为2为小数的元</td>
<td>1000002 -&gt; 10,000.02      </td>
</tr>
<tr>
<td>fileSizeFormatter</td>
<td>文件大小格式化,原始值为Byte</td>
<td>15.02M         </td>
</tr>
<tr>
<td>dateFormatter</td>
<td>日期格式化（yyyy-MM-dd）,日期对象或日期时间字符串（支持GMT）</td>
<td>2015-09-09</td>
</tr>
<tr>
<td>dateTimeFormatter</td>
<td>格式化为：yyyy-MM-dd HH:mm:ss</td>
<td>2015-09-09 12:12:12</td>
</tr>
<tr>
<td>timeFormatter</td>
<td>格式日期对象为时间格式：HH:mm:ss</td>
<td>12:12:12</td>
</tr>
<tr>
<td>secondFormatter</td>
<td>格式化秒为可读格式。</td>
<td>1天12:12:01</td>
</tr>
<tr>
<td>millisecondFormatter</td>
<td>格式化毫秒为可读格式。</td>
<td>1天12:12:01.222</td>
</tr>
<tr>
<td>contentFormatter</td>
<td>格式化长文本数据。格式化为可以点击显示/隐藏模式,默认显示20字符</td>
</tr>
<tr>
<td>linkFormatter</td>
<td>连接格式化，格式化为可点击弹出新页面访问的方式</td>
</tr>
<tr>
<td>jsonFormatter</td>
<td>格式化json数据为可读格式。</td>
</tr>
</tbody>
</table>
<p>调用案例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"amount"</span> <span class="attr">formatter</span>=<span class="string">“moneyFormatter”</span>&gt;</span>金额<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Form表单"><a href="#Form表单" class="headerlink" title="Form表单"></a>Form表单</h2><p>本节将先介绍EasyUI本身的默认表单验证，以及对应扩展实现，然后在详细介绍acooly框架中的应用。</p>
<h3 id="EasyUI验证框架"><a href="#EasyUI验证框架" class="headerlink" title="EasyUI验证框架"></a>EasyUI验证框架</h3><p>EasyUI中的表单验证主要通过其内置的验证器(validator)实现，除了required属性基本应用于所有表单元素外，其他一般都应用在: easyui-validatebox（文本框） 和 easyui-numberbox(数字框)。</p>
<p>验证相关的属性如下：</p>
<ul>
<li>validType：验证类型见下示例</li>
<li>missingMessage：未填写时显示的信息</li>
<li>invalidMessage：无效的数据类型时显示的信息</li>
<li>required=”true” 必填项</li>
</ul>
<p>easyui-numberbox专用：</p>
<ul>
<li>min：最小值</li>
<li>max：最大值</li>
<li>precision：精度，小数点位数</li>
</ul>
<p>以上属性中，validType是验证的核心，指定了该表单采用什么方式验证，支持多种验证器同时使用，也支持外部扩展。</p>
<p><strong>内置验证</strong></p>
<table>
<thead>
<tr>
<th>validType</th>
<th>comment</th>
<th>demo</th>
</tr>
</thead>
<tbody>
<tr>
<td>length</td>
<td>长度验证，一个字符计算为1个长度。</td>
<td>validType=”length[2,4]” </td>
</tr>
<tr>
<td>email</td>
<td>email格式验证</td>
<td>validType=”emal” </td>
</tr>
<tr>
<td>url</td>
<td>url格式验证</td>
<td>validType=”url” </td>
</tr>
<tr>
<td>remote</td>
<td>远程验证。ajax方式访问url，返回值为true表示成功。这里不推荐使用，因为每输入一个字符都需要请求一次服务器端，建议改总需求采用人工验证方式在提交前处理。</td>
</tr>
</tbody>
</table>
<p><strong>扩展验证</strong></p>
<p>acooly框架根据常见功能，扩展了一些常见的验证，在框架的功能中可以直接使用。</p>
<p>源代码文件：manage/script/acooly.easyui.js</p>
<table>
<thead>
<tr>
<th>validType</th>
<th>comment</th>
<th>demo</th>
</tr>
</thead>
<tbody>
<tr>
<td>bytelength</td>
<td>长度验证，一个字节计算为1个长度，一个汉字算2个长度，主要应用于ORACLE等数据库。</td>
<td>validType=”bytelength[2,4]”</td>
</tr>
<tr>
<td>equals</td>
<td>判断两个表单值相等。</td>
<td>validtype=”equals[‘#newPassword’]”</td>
</tr>
<tr>
<td>CHS</td>
<td>汉字验证，要求输入的必须都是汉字</td>
<td>validType=”CHS” </td>
</tr>
<tr>
<td>phone</td>
<td>座机号码验证</td>
</tr>
<tr>
<td>mobile</td>
<td>移动手机号码验证</td>
<td>validType=”mobile” </td>
</tr>
<tr>
<td>zipcode</td>
<td>国内邮编验证</td>
<td>validType=”zipcode” </td>
</tr>
<tr>
<td>account</td>
<td>常用账号格式（只能包括 _ 数字 字母）</td>
<td>validType=”account” </td>
</tr>
<tr>
<td>commonRegExp</td>
<td>正则验证</td>
<td>validType=”commonRegExp[‘[\\w]{6,16}’,’密码由任意字母、数字、下划线组成，长度6-16字节’]”            </td>
</tr>
<tr>
<td>validImg</td>
<td>图片验证，param[0]为bmp,jpg,gif(用逗号隔开),param[1]为错误提示消息</td>
</tr>
<tr>
<td>simplecsv</td>
<td>简单csv格式验证，包括逗号风格格式</td>
</tr>
<tr>
<td>money</td>
<td>金额验证</td>
</tr>
<tr>
<td>cert</td>
<td>身份证号码验证</td>
</tr>
</tbody>
</table>
<p>如需要制定扩展验证，可以采用如下方法或参考以上自定义验证的实现源代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.extend($.fn.validatebox.defaults.rules, &#123;</span><br><span class="line">	customRuleName : &#123;</span><br><span class="line">		validator : <span class="function"><span class="keyword">function</span>(<span class="params">value, param</span>) </span>&#123;</span><br><span class="line">				<span class="comment">//验证逻辑</span></span><br><span class="line">		&#125;,</span><br><span class="line">		message : <span class="string">'自定义消息'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>强烈建议：如果有扩展需求，统一提交到acooly框架的isuee，有框架统一扩展使用。</p>
</blockquote>
<p><strong>验证实例</strong></p>
<p>简单验证：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">邮件：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"easyui-validatebox"</span> <span class="attr">required</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">validType</span>=<span class="string">"email"</span> <span class="attr">missingMessage</span>=<span class="string">"请输入您的电子邮箱地址"</span> <span class="attr">invalidMessage</span>=<span class="string">"请输入正确的电子邮箱格式"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">昵称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"nickName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"easyui-validatebox"</span> <span class="attr">required</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">validType</span>=<span class="string">"length[2,4]"</span> <span class="attr">missingMessage</span>=<span class="string">"请输入您的昵称"</span> <span class="attr">invalidMessage</span>=<span class="string">"姓名只能是2-4个字"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>组合验证：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"realName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"easyui-validatebox"</span> <span class="attr">required</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">data-options</span>=<span class="string">"validType:['CHS','length[2,4]']"</span> <span class="attr">missingMessage</span>=<span class="string">"请输入您的真实姓名"</span> <span class="attr">invalidMessage</span>=<span class="string">"姓名只能是2-4个汉字"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>特别注意：组合验证的时候请使用data-options方式配置数组验证（如上面的实例），不建议采用validType属性方式配置，否则可能不会生效。</p>
</blockquote>
<h3 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h3><p>acooly框架的表单提交采用jquery.form插件方案的ajaxSubmit方法，在ajaxSubmit方法中可以通过beforeSerialize和beforeSubmit完成前置自定义验证，最后提交前会调用EasyUI验证框架验证。</p>
<blockquote>
<p>jquery.form的参考文档请参见：<a href="http://malsup.com/jquery/form/#options-object" target="_blank" rel="noopener">http://malsup.com/jquery/form/#options-object</a></p>
</blockquote>
<p>表单的验证的完整案例请参考：$.acooly.framework.create 封装发放的源代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#formId'</span>).ajaxSubmit(&#123;</span><br><span class="line">	beforeSerialize: <span class="function"><span class="keyword">function</span>(<span class="params">formData,options</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// 序列化form表单值前，可以动态修改表单的值。</span></span><br><span class="line">	&#125;,</span><br><span class="line">	beforeSubmit: <span class="function"><span class="keyword">function</span>(<span class="params">formData, jqForm, options</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// 1、提交前，可以插入自定义的验证</span></span><br><span class="line">		<span class="comment">// 2、最后调用EasyUI的验证框架：$('#formId').form('validate');</span></span><br><span class="line">		<span class="comment">// 3、返回true表示通过，反正为false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	success: <span class="function"><span class="keyword">function</span>（<span class="title">result</span>, <span class="title">statusText</span>）</span>&#123;</span><br><span class="line">		<span class="comment">// ajax请求后的成功响应，如果统一采用acooly框架定义的JsonResult,则模板代码为：</span></span><br><span class="line">		<span class="keyword">if</span> (result.success) &#123;</span><br><span class="line">			<span class="comment">// 成功的处理</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// 失败的处理</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 消息提示，如果有则底部弹出提示框显示。</span></span><br><span class="line">		<span class="keyword">if</span> (result.message) &#123;</span><br><span class="line">			$.messager.show(&#123;<span class="attr">title</span> : <span class="string">'提示'</span>,<span class="attr">msg</span> : result.message&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	error : <span class="function"><span class="keyword">function</span>(<span class="params">XmlHttpRequest, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 统一处理服务器端异常，一般为非200返回情况。</span></span><br><span class="line">		$.messager.alert(<span class="string">'提示'</span>, errorThrown);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上模块代码是ajaxSubmit在acooly中的常规实现，你可以根据需求，参考jquery.form插件的需求进行调整。然后一般通过点击按钮时间调用该方法实现ajax form表单提交。</p>
<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>表单操作中，涉及提交数据自动绑定为domain/entity对象，响应数据（编辑时）domain/entity自动绑定视图表单的功能，这种方式有利于提高高发效率。目前acooly框架中，上送数据的绑定为entity采用的是springMvc的原生解决方案，这里不详细介绍。</p>
<p>在编辑时拉取的entity的属性数据自动绑定视图的表单方案选择的是jodd.form的springside扩展方案：jodd.form taglib。</p>
<ul>
<li><p>实现功能：指定的scope内的实体变量名作为实体数据源，反射实体属性名称，与标签内的表单名称匹配，如果匹配上，则自动为表单赋值为属性值，支持常规的：input和select表单。</p>
</li>
<li><p>用法参考：自动代码生成后的{entity}Edit.jsp视图源代码。</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"manage_customer_editform"</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">jodd:form</span> <span class="attr">bean</span>=<span class="string">"customer"</span> <span class="attr">scope</span>=<span class="string">"request"</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- 表单 --&gt;</span></span><br><span class="line">      </span><br><span class="line">  <span class="tag">&lt;/<span class="name">jodd:form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="页面框架"><a href="#页面框架" class="headerlink" title="页面框架"></a>页面框架</h2><p>页面框架的封装主要是使用esayui和ztree对后台管理的页面框架整体的结构，基础功能的封装，包括整体布局，两级菜单的显示，logo，系统功能等。这里不做详细的介绍，如有兴趣，请参见源代码。</p>
<ul>
<li>/manage/assert/script/acooly.system.js</li>
<li>/manage/assert/script/acooly.layout.js</li>
<li>/manage/assert/script/acooly.portal.js</li>
</ul>
<h1 id="案例经验"><a href="#案例经验" class="headerlink" title="案例经验"></a>案例经验</h1><h2 id="标准CRUD"><a href="#标准CRUD" class="headerlink" title="标准CRUD"></a>标准CRUD</h2><p>请参考：自动代码生成的代码。所有自动代码生成的单实体的功能包含了网站的CRUD功能。</p>
<h2 id="分类管理"><a href="#分类管理" class="headerlink" title="分类管理"></a>分类管理</h2><p>分类管理在后台管理开发中是比较常见的场景。从数据结构上来看，首先有一个多级或无限极的分类实体，然后由一个具体分类下管理的主体实体。所以在这种场景下，我们需要管理的是2个实体,但是在视图上，我们习惯采用单个整合视图来操作个管理更符合人类习惯。</p>
<p>请参考：acooly-showcase中: <strong>商户管理（树型）</strong>功能。</p>
<h2 id="主从管理"><a href="#主从管理" class="headerlink" title="主从管理"></a>主从管理</h2><p>主要应对场景为一个主表对应多个子表的协调管理。例如客户管理，主表为客户主信息表，可能存在多个客户子表，例如：客户基础信息，客户联系信息，客户认证信息，客户扩展信息等。</p>
<p>该案例主要展示在该场景下的主要特性处理方案：</p>
<ul>
<li>主对象的管理（CRUD，分页查询，导入和导出）</li>
<li>独立加载单和子tab，防止同时加载全部和重复加载。</li>
<li>tab内的子模块的管理</li>
</ul>
<p>请参考：acooly-showcase中:<strong>客户管理(父子)</strong>功能。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/09/18/acooly/acooly-guide-boss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/18/acooly/acooly-guide-boss/" itemprop="url">acooly框架-BOSS开发指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-18T14:57:14+08:00">
                2017-09-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/acooly开发框架/" itemprop="url" rel="index">
                    <span itemprop="name">acooly开发框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <style>img {max-width:100%;}</style>

<p>管理视图的开发在acooly框架下，我们选择的是easyui作为基本的前端解决方案，采用JSP作为视图渲染。</p>
<blockquote>
<p>本章节，先总体描述后台管理的easyui开发的一些约定，注意点，然后在列举最几种常用的视图开发场景的案例。</p>
</blockquote>
<h1 id="基础知识准备"><a href="#基础知识准备" class="headerlink" title="基础知识准备"></a>基础知识准备</h1><p>如果需要进行acooly框架的后台管理功能开发，需要进行一些基础技术栈的准备。</p>
<ul>
<li>html：熟悉HTML语法</li>
<li>javascript：要求至少能阅读常规代码，编写基本的表单验证功能。</li>
<li>jquery：熟悉常规的jquery操作，包括：选择器，ajax的语法和异常处理。</li>
<li>easyui：至少熟悉：布局管理（easyui-layout），表格（easyui-datagrid），弹出框（dialog），按钮（easyui-linkbutton）等</li>
<li>jsp/jstl/freemarker: 至少熟悉：servlet内置变量的操作，自定义变量输出，Map和List的跌倒，if控制语句等。</li>
</ul>
<h1 id="开发规范和约定"><a href="#开发规范和约定" class="headerlink" title="开发规范和约定"></a>开发规范和约定</h1><h2 id="元素ID全局唯一"><a href="#元素ID全局唯一" class="headerlink" title="元素ID全局唯一"></a>元素ID全局唯一</h2><p>所有后台的界面采用EASYUI搭建，每个模块功能页面默认采用AJAX方式加载，JS运行SCOPE是唯一的，要求整站的所有页面的所有元素的ID唯一，否则可能出现不可预料的问题。</p>
<p>命名规则为：manage_模块名称(一般为受托管的实体名称)_UI组件名称_其他</p>
<p>如：manage_customer_datagrid , manage_customer_form,manage_customer_searchform, manage_customer_button_search</p>
<h2 id="基本操作模式"><a href="#基本操作模式" class="headerlink" title="基本操作模式"></a>基本操作模式</h2><p>所有后台功能模块的基本操作模式都是采用：主界面 + 弹出框操作模式，主界面一般为列表(datagrid),也可以是多个datagrid与其他UI组件的整合，如果左右，上下结构，与zTree,Tab等组件的组合等。</p>
<p>功能包括：独立的多条件查询区域，独立的横向工具条，表格内每行的功能按钮等。</p>
<h1 id="封装功能介绍"><a href="#封装功能介绍" class="headerlink" title="封装功能介绍"></a>封装功能介绍</h1><p>acooly框架的后台基于easyui，在开发规范和约定的基础上，做了较多的基础功能封装。</p>
<h2 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h2><p>常规操作的封装主要包括: 操作的CRUD，查询，上传，下载等通用功能，同时提供非界面的确认操作模式封装。操作的封装主要在:</p>
<ul>
<li>/manage/assert/script/acooly.framework.js</li>
<li>/manage/assert/script/acooly.format.js</li>
<li>/manage/assert/script/acooly.verify.js</li>
</ul>
<p>你可以在运行时，通过查看页面源代码方式找到源代码，也可以acooly-components-security-${version}.jar中找到源代码文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.acooly<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>acooly-components-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;acooly.components.security&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：常规操作完整Demo是以自动代码生成的单模块功能，一个完整模块的功能几乎使用了大部分的常规操作封装。常规操作中的一些API因历史版本原因，虽然不是完善和优美的封装，但是暂时都没有改进或删除冗余，但都可以作为案例参考，使用者可以编写自己的封装函数使用。</p>
</blockquote>
<h3 id="添加和修改"><a href="#添加和修改" class="headerlink" title="添加和修改"></a>添加和修改</h3><p>提供统一的弹出dialog调用指定URL（create或edit）获取添加和编辑的视图，并在弹出框中显示，同时提供统一的按钮（提交）和(取消)，封装提交的表单请求，完成添加和编辑的保持操作。</p>
<p><strong>$.acooly.framework.create(opts)<br>$.acooly.framework.edit(opts)</strong></p>
<p>opts参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>添加或编辑视图地址(必填)</td>
</tr>
<tr>
<td>form</td>
<td>string</td>
<td>否</td>
<td>添加和编辑的form表单ID（可选，如果传入entity参数，则可以不填写）</td>
</tr>
<tr>
<td>datagrid</td>
<td>string</td>
<td>否</td>
<td>列表视图datagrid组件ID（可选，如果传入entity参数，则可以不填写）</td>
</tr>
<tr>
<td>entity</td>
<td>string</td>
<td>否</td>
<td>添加和编辑的实体类名称首字母小写(可选，代替：form和datagrid)</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>否</td>
<td>标题，默认为：添加或修改</td>
</tr>
<tr>
<td>top</td>
<td>int</td>
<td>否</td>
<td>位置top，默认居中的top</td>
</tr>
<tr>
<td>width</td>
<td>int</td>
<td>否</td>
<td>宽度，默认：500px</td>
</tr>
<tr>
<td>height</td>
<td>int</td>
<td>否</td>
<td>高度，默认：auto，根据类型显示</td>
</tr>
<tr>
<td>submitButton</td>
<td>string</td>
<td>否</td>
<td>提交按钮的label，默认：增加或修改</td>
</tr>
<tr>
<td>reload</td>
<td>boolean</td>
<td>否</td>
<td>提交成功后，是否reload列表datagrid,如果为true，则提交成功后重新load列表数据，如果为false(默认)，动态插入新数据（添加）或更新（编辑）datagrid对应的行。</td>
</tr>
<tr>
<td>maximizable</td>
<td>boolean</td>
<td>否</td>
<td>弹出框是否可以最大化，true或false(默认)</td>
</tr>
<tr>
<td>onSubmit</td>
<td>function</td>
<td>否</td>
<td>表单提交前，在原有easyui表单验证前的拦截函数，可以在本函数中进行附加的提交前验证和对表单元素赋值操作。如果返回false，则终止提交。无传入参数，可以通过jquery选择器获取当前scope的元素值。</td>
</tr>
<tr>
<td>onSuccess</td>
<td>function</td>
<td>否</td>
<td>提交成功后的回调函数（result.success = true），传入参数为ajax表单提交的返回值（一般为JsonEntityResult的Json数据）。</td>
</tr>
<tr>
<td>onFaillure</td>
<td>function</td>
<td>否</td>
<td>提交失败后回调函数（result.success = false），传入参数为ajax表单提交的返回值（一般为JsonEntityResult的Json数据）。</td>
</tr>
<tr>
<td>onClose</td>
<td>function</td>
<td>否</td>
<td>关闭弹出框回调函数</td>
</tr>
<tr>
<td>ajaxData</td>
<td>json</td>
<td>否</td>
<td>可以传递添加和编辑视图额外的请求参数。如{“search_EQ_id”:1}</td>
</tr>
<tr>
<td>buttons</td>
<td>array</td>
<td>否</td>
<td>可增加按钮。格式：{id:xx,text:xxx,hander:function(){…}}</td>
</tr>
</tbody>
</table>
<blockquote>
<p>框架最初为提供添加和删除的相关回调函数，采用命名约定的隐含回调函数方式处理。处理方式都是在添加或编辑的视图界面中，声明指定名称的函数实现回调。包括：<br>${formId}_beforeSubmit：表示表单序列化完成后，提交前的拦截函数。<br>${formId}_onSubmit：同onSubmit</p>
</blockquote>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定视图URL，实体名，高度，宽度等</span></span><br><span class="line">$.acooly.framework.create(&#123;<span class="attr">url</span>:<span class="string">'/manage/showcase/customer/create.html'</span>,<span class="attr">entity</span>:<span class="string">'customer'</span>,<span class="attr">width</span>:<span class="number">500</span>,<span class="attr">height</span>:<span class="number">400</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增加特殊按钮</span></span><br><span class="line">$.acooly.framework.create(&#123;</span><br><span class="line">    url:<span class="string">'/manage/module/app/app/create.html'</span>,</span><br><span class="line">    entity:<span class="string">'app'</span>,</span><br><span class="line">    width:<span class="number">500</span>,<span class="attr">height</span>:<span class="number">400</span>,</span><br><span class="line">    hideSaveBtn:<span class="literal">true</span>,</span><br><span class="line">    buttons:[&#123;</span><br><span class="line">            id:<span class="string">"manage_app_btn_ok"</span>,</span><br><span class="line">            text:<span class="string">"&lt;i class=\"fa fa-book fa-lg fa-fw fa-col\"&gt;&lt;/i&gt;审批通过"</span>,</span><br><span class="line">            handler:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 获取按钮当前ID</span></span><br><span class="line">                <span class="built_in">console</span>.info($(<span class="keyword">this</span>).attr(<span class="string">'id'</span>));</span><br><span class="line">                $.messager.alert(<span class="string">'提示'</span>, <span class="string">"这个审批按钮，这里可以通过JS操作表单的值，然后再调用ajaxSubmitHander提交表单，行为与原来的提交表单一致"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// do something. eg: change action url; change form-field value.</span></span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 提交表单（create or edit）,前4个参数必选。</span></span><br><span class="line">                $.acooly.framework.ajaxSubmitHandler(<span class="string">"create"</span>,$(<span class="keyword">this</span>),<span class="string">"manage_app_editform"</span>,<span class="string">"manage_app_datagrid"</span>, <span class="literal">true</span>,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                      <span class="comment">// onSubmit: before submit</span></span><br><span class="line">                        <span class="built_in">console</span>.info(<span class="string">"onsubmit"</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                        <span class="comment">// onSuccess</span></span><br><span class="line">                        <span class="built_in">console</span>.info(<span class="string">"onSuccess"</span>);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        <span class="comment">// onFailure</span></span><br><span class="line">                        <span class="built_in">console</span>.info(<span class="string">"onFailure"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            id:<span class="string">"manage_app_btn_no"</span>,</span><br><span class="line">            text:<span class="string">"&lt;i class=\"fa fa-book fa-lg fa-fw fa-col\"&gt;&lt;/i&gt;审批驳回"</span>,</span><br><span class="line">            handler:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                $.acooly.framework.ajaxSubmitHandler(<span class="string">"create"</span>,$(<span class="keyword">this</span>),<span class="string">"manage_app_editform"</span>,<span class="string">"manage_app_datagrid"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="通用表单查询"><a href="#通用表单查询" class="headerlink" title="通用表单查询"></a>通用表单查询</h3><p>提供统一的的通用表单查询封装，特性如下：</p>
<ol>
<li>自动序列化指定元素ID（可以是formId,也可以是任意的DIV的ID）下的所有表单为json格式，作为查询条件。</li>
<li>查询完成后，获取的新数据，自动reload制定的表格数据（datagrid）</li>
<li>自动注册查询表单的回传按键为提交查询</li>
</ol>
<p><strong>$.acooly.framework.search(containerId,datagridId);</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>containerId</td>
<td>string</td>
<td>是</td>
<td>formId,也可以是任意的DIV的ID</td>
</tr>
<tr>
<td>datagridId</td>
<td>string</td>
<td>是</td>
<td>显示查询结果的datagrid</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.search(<span class="string">'manage_customer_searchform'</span>,<span class="string">'manage_customer_datagrid'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0);"</span> <span class="attr">class</span>=<span class="string">"easyui-linkbutton"</span> <span class="attr">data-options</span>=<span class="string">"plain:false"</span> <span class="attr">onclick</span>=<span class="string">"$.acooly.framework.search('manage_customer_searchform','manage_customer_datagrid');"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-search fa-lg fa-fw fa-col"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表单回传自动提交查询：<br>$.acooly.framework.registerKeydown(containerId,datagridId)</p>
<p>该方法需要在查询界面初始化时调用。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.acooly.framework.registerKeydown(<span class="string">'manage_customer_searchform'</span>,<span class="string">'manage_customer_datagrid'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><p>提供通用弹出框查询视图界面封装。</p>
<p><strong>$.acooly.framework.show(url, width, height)<br>$.acooly.framework.get(opts)</strong></p>
<p>opts参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>视图的URL</td>
</tr>
<tr>
<td>width</td>
<td>int</td>
<td>否</td>
<td>宽度，默认:400px</td>
</tr>
<tr>
<td>height</td>
<td>int</td>
<td>否</td>
<td>高度，默认：300px</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>否</td>
<td>弹出框标题，默认为：查看</td>
</tr>
</tbody>
</table>
<p>get与show是不同时期的封装，为兼容老版本，所以同时支持，不同在于，get可以指定弹出框的标题，推荐使用get</p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>提供通用的删除功能封装，支持单个和批量，同时删除前二次确认。</p>
<p><strong>删除单条</strong><br>对制定id的数据提供删除功能，url,id和datagrid为必选。</p>
<p><strong>$.acooly.framework.remove(url, id, datagrid, confirmTitle, confirmMessage)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.remove(<span class="string">'/manage/showcase/customer/deleteJson.html'</span>,<span class="string">'1'</span>,<span class="string">'manage_customer_datagrid'</span>);</span><br></pre></td></tr></table></figure>
<p><strong>批量删除</strong><br>批量删除提供对datagrid选择的行批量删除的功能，url和datagrid为必选。</p>
<p><strong>$.acooly.framework.removes(url, datagrid, confirmTitle, confirmMessage)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.removes(<span class="string">'/manage/showcase/customer/deleteJson.html'</span>,<span class="string">'manage_customer_datagrid'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="导出文件"><a href="#导出文件" class="headerlink" title="导出文件"></a>导出文件</h3><p>提供以当前查询表单所选作为条件的动态查询后导出EXCEL和CSV的功能。可以指定导出文件名。</p>
<p><strong>$.acooly.framework.exports(url, searchForm, fileName);</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>文件下载的URL，EXCEL和CSV有不同的URL</td>
</tr>
<tr>
<td>searchForm</td>
<td>string</td>
<td>是</td>
<td>查询的表单的父元素ID</td>
</tr>
<tr>
<td>fileName</td>
<td>string</td>
<td>否</td>
<td>下载的文件名，默认为服务器端指定。</td>
</tr>
</tbody>
</table>
<p>实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出EXCEL</span></span><br><span class="line">$.acooly.framework.exports(<span class="string">'/manage/showcase/customer/exportXls.html'</span>,<span class="string">'manage_customer_searchform'</span>,<span class="string">'客户信息表'</span>)<span class="string">"</span></span><br><span class="line"><span class="string">// 导出CSV</span></span><br><span class="line"><span class="string">$.acooly.framework.exports('/manage/showcase/customer/exportCsv.html','manage_customer_searchform','客户信息表')</span></span><br></pre></td></tr></table></figure>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>提供通用的文件上传功能，也可以作为文件导入的界面使用。</p>
<p><strong>$.acooly.framework.createUploadify(opts);</strong></p>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>文件上传的URL</td>
</tr>
<tr>
<td>formData</td>
<td>json</td>
<td>否</td>
<td>POST提交的表单数据</td>
</tr>
<tr>
<td>jsessionid</td>
<td>string</td>
<td>是</td>
<td>因为采用的是第三方组件，无法直接使用cookie,需要通过URL传递sessionid，jsp可传入：&lt;%=request.getSession().getId()%&gt;。</td>
</tr>
<tr>
<td>messager</td>
<td>string</td>
<td>是</td>
<td>上传的过程消息显示label元素ID</td>
</tr>
<tr>
<td>uploader</td>
<td>string</td>
<td>是</td>
<td>上传组件的唯一ID</td>
</tr>
</tbody>
</table>
<p>实例：</p>
<p>请参考自动代码生成的数据导入视图。{entity}Import.jsp</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.createUploadify(&#123;</span><br><span class="line">	<span class="comment">/** 上传导入的URL */</span></span><br><span class="line">	url:<span class="string">'/manage/showcase/customer/importJson.html?_csrf=$&#123;requestScope["org.springframework.security.web.csrf.CsrfToken"].token&#125;&amp;splitKey=v'</span>,</span><br><span class="line">	<span class="comment">/** 导入操作消息容器 */</span></span><br><span class="line">	messager:<span class="string">'manage_customer_import_uploader_message'</span>,</span><br><span class="line">	<span class="comment">/** 上传导入文件表单ID */</span></span><br><span class="line">	uploader:<span class="string">'manage_customer_import_uploader_file'</span>,</span><br><span class="line">	jsessionid:<span class="string">'&lt;%=request.getSession().getId()%&gt;'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="通用询问请求操作"><a href="#通用询问请求操作" class="headerlink" title="通用询问请求操作"></a>通用询问请求操作</h3><p>前端管理功能开发中，存在很多无界面的询问二次确认的请求操作，场景为：点击按钮(或其他)触发，询问二次确认，确定后，请求服务器端一个指定URL，待服务器端完成操作后，提供操作结果。一般应用于在datagrid中选择了行后的对应操作，如：禁用，启用，移动等。</p>
<p><strong>$.acooly.framework.confirmRequest(url, requestData, datagrid, confirmTitle, confirmMessage, onSuccess, onFailure)</strong></p>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>是</td>
<td>操作的URL</td>
</tr>
<tr>
<td>requestData</td>
<td>json</td>
<td>否</td>
<td>POST请求的数据</td>
</tr>
<tr>
<td>datagrid</td>
<td>string</td>
<td>是</td>
<td>完成请求后，需要刷新的列表</td>
</tr>
<tr>
<td>confirmTitle</td>
<td>string</td>
<td>否</td>
<td>确认框标题，默认：确定</td>
</tr>
<tr>
<td>confirmMessage</td>
<td>string</td>
<td>否</td>
<td>确认框提示文字，默认：您是否要提交该操作？</td>
</tr>
<tr>
<td>onSuccess</td>
<td>function</td>
<td>否</td>
<td>提交成功后的回调函数（result.success = true），传入参数为ajax表单提交的返回值（一般为JsonResult的Json数据）。</td>
</tr>
<tr>
<td>onFailure</td>
<td>function</td>
<td>否</td>
<td>提交成功后的回调函数（result.success = false），传入参数为ajax表单提交的返回值（一般为JsonResult的Json数据）</td>
</tr>
</tbody>
</table>
<h3 id="工具方法"><a href="#工具方法" class="headerlink" title="工具方法"></a>工具方法</h3><h4 id="获取选中的Grid行"><a href="#获取选中的Grid行" class="headerlink" title="获取选中的Grid行"></a>获取选中的Grid行</h4><p>提供了通用的选择Datagrid行的帮助方法，返回为当前选择行的对应数据. 同时支持datagrid和treegrid</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.getSelectedRow(datagrid);</span><br></pre></td></tr></table></figure>
<h4 id="获取选择的Tab索引号"><a href="#获取选择的Tab索引号" class="headerlink" title="获取选择的Tab索引号"></a>获取选择的Tab索引号</h4><p>该方法一般用于判断当前选择了那个Tab，然后可以通过tab的onSelect事件绑定来协同处理选中某个tab后的操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.getSelectedTabIndex(tabsId);</span><br></pre></td></tr></table></figure>
<h4 id="Grid行选择事件触发"><a href="#Grid行选择事件触发" class="headerlink" title="Grid行选择事件触发"></a>Grid行选择事件触发</h4><p>用于触发选中Datagrid的行后的回调操作。选中grid的行，如果未选择则提示错误，否则回调传入的函数逻辑。一般用于必须选择了某行采用进行后续操作逻辑的处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.acooly.framework.fireSelectRow(gridId, selectedCallBack, errorMessage)</span><br></pre></td></tr></table></figure>
<h4 id="手动加载Grid"><a href="#手动加载Grid" class="headerlink" title="手动加载Grid"></a>手动加载Grid</h4><p>一般用于特殊场景，需要手动通过ajax获取数据，然后手动加载显示Grid数据的场景。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// opts:gridId,url,ajaxData</span></span><br><span class="line">$.acooly.framework.loadGrid(opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新加载（刷新）</span></span><br><span class="line">$.acooly.framework.reloadGrid(gridId)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：为防止重复加载，可以预先设置datagrid为不可显示，同时不要设置datagrid的url对象，在加载完成后，在渲染和显示datagrid。</p>
</blockquote>
<h1 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h1><h2 id="DataGrid"><a href="#DataGrid" class="headerlink" title="DataGrid"></a>DataGrid</h2><p>EasyUI的DataGrid组件是BOSS后台最常用的组件，没有之一，就是最常用的。数据查询，数据管理首页等。本节主要针对acooly框架对DataGrid的使用和扩展进行说明，DataGrid本身的大量功能和特性请参考EASYUI官方文档和Demo。</p>
<blockquote>
<p>EasyUI的DataGrid：<a href="http://www.jeasyui.com/documentation/index.php" target="_blank">文档</a>和<a href="http://www.jeasyui.com/demo/main/index.php?plugin=DataGrid&theme=default&dir=ltr&pitem=" target="_blank">Demo</a></p>
</blockquote>
<p>建议代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"manage_customer_datagrid"</span> <span class="attr">class</span>=<span class="string">"easyui-datagrid"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">url</span>=<span class="string">"/manage/showcase/customer/listJson.html"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">toolbar</span>=<span class="string">"#manage_customer_toolbar"</span> <span class="attr">fit</span>=<span class="string">"true"</span> <span class="attr">border</span>=<span class="string">"false"</span> <span class="attr">fitColumns</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pagination</span>=<span class="string">"true"</span> <span class="attr">idField</span>=<span class="string">"id"</span> <span class="attr">pageSize</span>=<span class="string">"20"</span> <span class="attr">pageList</span>=<span class="string">"[ 10, 20, 30, 40, 50 ]"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">sortName</span>=<span class="string">"id"</span> <span class="attr">sortOrder</span>=<span class="string">"desc"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">checkOnSelect</span>=<span class="string">"true"</span> <span class="attr">selectOnCheck</span>=<span class="string">"true"</span> <span class="attr">singleSelect</span>=<span class="string">"true"</span> <span class="attr">nowrap</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"showCheckboxWithId"</span> <span class="attr">checkbox</span>=<span class="string">"true"</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123; return row.id &#125;"</span>&gt;</span>选择<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"id"</span> <span class="attr">sum</span>=<span class="string">"true"</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"username"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span>     </span><br><span class="line">       <span class="comment">&lt;!-- 其他列 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h3><p>acooly框架中，Datagrid的使用方式采用html代码方式，通过标准table标签，添加class=”easyui-datagrid”方式标记为datagrid组件，然后通过属性定义来控制行为。</p>
<p>常用属性说明：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>必选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>是</td>
<td>遵循acooly框架统一的命名约定。</td>
</tr>
<tr>
<td>url</td>
<td>string</td>
<td>否</td>
<td>数据拉取的URL，对应的springMVC方法一定是返回: JsonListResult结构（这里是约定，当然你也可以直接返回一个自定义的JSON结构，只要包含 rows和total两个Datagrid需要的属性即可，但这里不推荐）；特别需要注意，该参数如果填写，则表示视图渲染完成后，会自动访问URL拉去数据，如果遇到需要动态拉取数据的情况，该参数一般先不填写，并设置datagrid为hide，手动加载拉取并渲染后再show.</td>
</tr>
<tr>
<td>toolbar</td>
<td>string</td>
<td>否</td>
<td>指定datagrid的toolbar菜单的元素ID，一般为一组linkbutton的组合，如果没有，则可以不填写该属性。</td>
</tr>
<tr>
<td>fit</td>
<td>boolean</td>
<td>否</td>
<td>表示默认表格最大化填充父元素。</td>
</tr>
<tr>
<td>border</td>
<td>boolean</td>
<td>否</td>
<td>是否显示表格边框</td>
</tr>
<tr>
<td>fitColumns</td>
<td>boolean</td>
<td>否</td>
<td>true/false，表示所有列数据的是否按当前屏幕大小显示，特别重要的属性，如果设置为true，则表示如果列过度操作屏幕横向宽度的情况，不会显示横向滚动条。所以，这里统一建议全部设置为：false</td>
</tr>
<tr>
<td>pagination</td>
<td>boolean</td>
<td>否</td>
<td>是否启用分页功能</td>
</tr>
<tr>
<td>pageSize</td>
<td>int</td>
<td>否</td>
<td>默认分页大小，推荐：20，与服务器端默认值一致</td>
</tr>
<tr>
<td>pageList</td>
<td>array</td>
<td>否</td>
<td>可选分页大小列表。例如：[ 10, 20, 30, 40, 50 ]</td>
</tr>
<tr>
<td>idField</td>
<td>string</td>
<td>是</td>
<td>每行的标志唯一的属性</td>
</tr>
<tr>
<td>sortName</td>
<td>string</td>
<td>否</td>
<td>默认排序的属性名称</td>
</tr>
<tr>
<td>sortOrder</td>
<td>string</td>
<td>否</td>
<td>默认排序方式：desc:降序，ase:升序</td>
</tr>
<tr>
<td>checkOnSelect</td>
<td>boolean</td>
<td>否</td>
<td>表示勾选每行的checkbox后，自动选择本行。</td>
</tr>
<tr>
<td>selectOnCheck</td>
<td>boolean</td>
<td>否</td>
<td>与checkOnSelect的行为类似，并相反。</td>
</tr>
<tr>
<td>singleSelect</td>
<td>boolean</td>
<td>否</td>
<td>是否只允许选择单行。如果无需批量操作（批量删除等）的场景，设置为false.</td>
</tr>
<tr>
<td>nowrap</td>
<td>boolean</td>
<td>否</td>
<td>操作单元格隐藏和显示时，文本是否自动换行。建议这是为false：表示会自动换行。</td>
</tr>
</tbody>
</table>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><p>datagrid官方要求的加载数据的结构为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  total:<span class="number">200</span>,</span><br><span class="line">  rows:[</span><br><span class="line">    &#123;<span class="string">"id"</span>:<span class="number">1</span>, <span class="string">"username"</span>:<span class="string">"zhangpu"</span>,...&#125;,</span><br><span class="line">    &#123;<span class="string">"id"</span>:<span class="number">2</span>, <span class="string">"username"</span>:<span class="string">"alise"</span>,...&#125;,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>acooly框架的数据结构为JsonListResult,增加了success,code,message,和扩展数据data.如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    code: <span class="string">""</span>,</span><br><span class="line">    message: <span class="string">""</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        allIdcardTypes: &#123; <span class="attr">cert</span>: <span class="string">"身份证"</span>, <span class="attr">pass</span>: <span class="string">"护照"</span>,<span class="attr">other</span>: <span class="string">"其他"</span>&#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    total: <span class="number">4</span></span><br><span class="line">    rows: [</span><br><span class="line">        &#123;...&#125;, &#123;...&#125;, &#123;...&#125;, &#123;...&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上数据扩展后，直接加载给datagrid对象，在datagrid组件内的所有列定义的formatter方法内可以直接使用额外传入的Map数据data来作为格式转换。</p>
<h3 id="列定义及格式化"><a href="#列定义及格式化" class="headerlink" title="列定义及格式化"></a>列定义及格式化</h3><p>easyui官方文档对列的定义和属性有全面的说明，请随时跟进需求参考并使用，这里说明的是acooly里面最常用的列定义方式及相关属性和格式化方案。</p>
<p><strong>通用列定义</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"username"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上定义表示：以每个返回实体JSON结构的username这个属性的原始值，名称为：“用户名”。</p>
<p><strong>自定义格式化</strong></p>
<p>datagrid的列格式化，是通过formatter参数提供一个回调函数处理，以函数的返回值作为列的最终输出。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">formatter : <span class="function"><span class="keyword">function</span>(<span class="params">value,row,index</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// value : 当前单元格原始值</span></span><br><span class="line">    <span class="comment">// row : 当前行的json数据，如：&#123;"id":1, "username":"zhangpu",...&#125;</span></span><br><span class="line">    <span class="comment">// index: 当前行在整个datagrid数据集中的位置索引，第1条为0.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意：目前框架对原生的formatter回调函数进行了扩展，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">formatter : <span class="function"><span class="keyword">function</span>(<span class="params">value,row,index,data,field</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// value : 当前单元格原始值</span></span><br><span class="line">    <span class="comment">// row : 当前行的json数据，如：&#123;"id":1, "username":"zhangpu",...&#125;</span></span><br><span class="line">    <span class="comment">// index: 当前行在整个datagrid数据集中的位置索引，第1条为0.</span></span><br><span class="line">    <span class="comment">// data: 当前datagrid的数据，包括分页和附带的其他数据，如：mapping数据。</span></span><br><span class="line">    <span class="comment">// field: 当前单元格的列名。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于以上能力，我们队列的格式化主要有一下几种常见模式：</p>
<ul>
<li><strong>Mapping数据转换</strong>：以服务器端返回的data数据中的mapping，转换原始值为中文。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"gender"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value)&#123; return formatRefrence('manage_customer_datagrid','allGenders',value);&#125; "</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>经过扩展和封装，目前可以写为：</p>
<p>注意：控制层的mapping变量名称必须按约定规则：”all”+首字母大写的列名+”s” ,本例为：allGenders</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.put(<span class="string">"allGenders"</span>,GenderEnum.mapping());</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"gender"</span> <span class="attr">formatter</span>=<span class="string">"mappingFormatter"</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>行操作按钮格式化</strong>：每行的最后一列可以定义为操作列，提供对本行的快捷操作连接按钮，但是一般在点击该类按钮的时候需要传入本行相关的参数，这里需要通过formatter方式构造整个链接及参数，需要使用到js的template,你可以采用任意的第三方js-template，但是默认情况下，acooly框架提供了简单的实现，可以支付几乎所有场景。</p>
<ul>
<li>formatAction方法是老的兼容方法，只实现了对第一个参数（manage_customer_action）指定的元素下的首个{0}替换为当前行的id（row.id）</li>
<li>formatString是推荐的标准模板方法，在第1个参数指定的元素下定义{0-n}的partten,采用后续传入的0-n个参数一一对应的替换。</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"rowActions"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">    return formatAction('manage_customer_action',value,row)</span></span></span><br><span class="line"><span class="tag"><span class="string">&#125;"</span>&gt;</span>动作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"rowActions"</span> <span class="attr">data-options</span>=<span class="string">"formatter:function(value, row, index)&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">    return formatString($('#manage_customer_action').html(),row.id);</span></span></span><br><span class="line"><span class="tag"><span class="string">&#125;"</span>&gt;</span>动作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>其他常用格式化封装</li>
</ul>
<table>
<thead>
<tr>
<th>格式化方法</th>
<th>说明</th>
<th>输出样例</th>
</tr>
</thead>
<tbody>
<tr>
<td>moneyFormatter</td>
<td>金额元的formatter，原始值为元</td>
<td>10000.02 -&gt; 10,000.02  </td>
</tr>
<tr>
<td>centMoneyFormatter</td>
<td>金额分格式化为2为小数的元</td>
<td>1000002 -&gt; 10,000.02      </td>
</tr>
<tr>
<td>fileSizeFormatter</td>
<td>文件大小格式化,原始值为Byte</td>
<td>15.02M         </td>
</tr>
<tr>
<td>dateFormatter</td>
<td>日期格式化（yyyy-MM-dd）,日期对象或日期时间字符串（支持GMT）</td>
<td>2015-09-09</td>
</tr>
<tr>
<td>dateTimeFormatter</td>
<td>格式化为：yyyy-MM-dd HH:mm:ss</td>
<td>2015-09-09 12:12:12</td>
</tr>
<tr>
<td>timeFormatter</td>
<td>格式日期对象为时间格式：HH:mm:ss</td>
<td>12:12:12</td>
</tr>
<tr>
<td>secondFormatter</td>
<td>格式化秒为可读格式。</td>
<td>1天12:12:01</td>
</tr>
<tr>
<td>millisecondFormatter</td>
<td>格式化毫秒为可读格式。</td>
<td>1天12:12:01.222</td>
</tr>
<tr>
<td>contentFormatter</td>
<td>格式化长文本数据。格式化为可以点击显示/隐藏模式,默认显示20字符</td>
</tr>
<tr>
<td>linkFormatter</td>
<td>连接格式化，格式化为可点击弹出新页面访问的方式</td>
</tr>
<tr>
<td>jsonFormatter</td>
<td>格式化json数据为可读格式。</td>
</tr>
</tbody>
</table>
<p>调用案例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th</span> <span class="attr">field</span>=<span class="string">"amount"</span> <span class="attr">formatter</span>=<span class="string">“moneyFormatter”</span>&gt;</span>金额<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Form表单"><a href="#Form表单" class="headerlink" title="Form表单"></a>Form表单</h2><p>本节将先介绍EasyUI本身的默认表单验证，以及对应扩展实现，然后在详细介绍acooly框架中的应用。</p>
<h3 id="EasyUI验证框架"><a href="#EasyUI验证框架" class="headerlink" title="EasyUI验证框架"></a>EasyUI验证框架</h3><p>EasyUI中的表单验证主要通过其内置的验证器(validator)实现，除了required属性基本应用于所有表单元素外，其他一般都应用在: easyui-validatebox（文本框） 和 easyui-numberbox(数字框)。</p>
<p>验证相关的属性如下：</p>
<ul>
<li>validType：验证类型见下示例</li>
<li>missingMessage：未填写时显示的信息</li>
<li>invalidMessage：无效的数据类型时显示的信息</li>
<li>required=”true” 必填项</li>
</ul>
<p>easyui-numberbox专用：</p>
<ul>
<li>min：最小值</li>
<li>max：最大值</li>
<li>precision：精度，小数点位数</li>
</ul>
<p>以上属性中，validType是验证的核心，指定了该表单采用什么方式验证，支持多种验证器同时使用，也支持外部扩展。</p>
<p><strong>内置验证</strong></p>
<table>
<thead>
<tr>
<th>validType</th>
<th>comment</th>
<th>demo</th>
</tr>
</thead>
<tbody>
<tr>
<td>length</td>
<td>长度验证，一个字符计算为1个长度。</td>
<td>validType=”length[2,4]” </td>
</tr>
<tr>
<td>email</td>
<td>email格式验证</td>
<td>validType=”emal” </td>
</tr>
<tr>
<td>url</td>
<td>url格式验证</td>
<td>validType=”url” </td>
</tr>
<tr>
<td>remote</td>
<td>远程验证。ajax方式访问url，返回值为true表示成功。这里不推荐使用，因为每输入一个字符都需要请求一次服务器端，建议改总需求采用人工验证方式在提交前处理。</td>
</tr>
</tbody>
</table>
<p><strong>扩展验证</strong></p>
<p>acooly框架根据常见功能，扩展了一些常见的验证，在框架的功能中可以直接使用。</p>
<p>源代码文件：manage/script/acooly.easyui.js</p>
<table>
<thead>
<tr>
<th>validType</th>
<th>comment</th>
<th>demo</th>
</tr>
</thead>
<tbody>
<tr>
<td>bytelength</td>
<td>长度验证，一个字节计算为1个长度，一个汉字算2个长度，主要应用于ORACLE等数据库。</td>
<td>validType=”bytelength[2,4]”</td>
</tr>
<tr>
<td>equals</td>
<td>判断两个表单值相等。</td>
<td>validtype=”equals[‘#newPassword’]”</td>
</tr>
<tr>
<td>CHS</td>
<td>汉字验证，要求输入的必须都是汉字</td>
<td>validType=”CHS” </td>
</tr>
<tr>
<td>phone</td>
<td>座机号码验证</td>
</tr>
<tr>
<td>mobile</td>
<td>移动手机号码验证</td>
<td>validType=”mobile” </td>
</tr>
<tr>
<td>zipcode</td>
<td>国内邮编验证</td>
<td>validType=”zipcode” </td>
</tr>
<tr>
<td>account</td>
<td>常用账号格式（只能包括 _ 数字 字母）</td>
<td>validType=”account” </td>
</tr>
<tr>
<td>commonRegExp</td>
<td>正则验证</td>
<td>validType=”commonRegExp[‘[\\w]{6,16}’,’密码由任意字母、数字、下划线组成，长度6-16字节’]”            </td>
</tr>
<tr>
<td>validImg</td>
<td>图片验证，param[0]为bmp,jpg,gif(用逗号隔开),param[1]为错误提示消息</td>
</tr>
<tr>
<td>simplecsv</td>
<td>简单csv格式验证，包括逗号风格格式</td>
</tr>
<tr>
<td>money</td>
<td>金额验证</td>
</tr>
<tr>
<td>cert</td>
<td>身份证号码验证</td>
</tr>
</tbody>
</table>
<p>如需要制定扩展验证，可以采用如下方法或参考以上自定义验证的实现源代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.extend($.fn.validatebox.defaults.rules, &#123;</span><br><span class="line">	customRuleName : &#123;</span><br><span class="line">		validator : <span class="function"><span class="keyword">function</span>(<span class="params">value, param</span>) </span>&#123;</span><br><span class="line">				<span class="comment">//验证逻辑</span></span><br><span class="line">		&#125;,</span><br><span class="line">		message : <span class="string">'自定义消息'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>强烈建议：如果有扩展需求，统一提交到acooly框架的isuee，有框架统一扩展使用。</p>
</blockquote>
<p><strong>验证实例</strong></p>
<p>简单验证：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">邮件：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"easyui-validatebox"</span> <span class="attr">required</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">validType</span>=<span class="string">"email"</span> <span class="attr">missingMessage</span>=<span class="string">"请输入您的电子邮箱地址"</span> <span class="attr">invalidMessage</span>=<span class="string">"请输入正确的电子邮箱格式"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">昵称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"nickName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"easyui-validatebox"</span> <span class="attr">required</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">validType</span>=<span class="string">"length[2,4]"</span> <span class="attr">missingMessage</span>=<span class="string">"请输入您的昵称"</span> <span class="attr">invalidMessage</span>=<span class="string">"姓名只能是2-4个字"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>组合验证：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"realName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"easyui-validatebox"</span> <span class="attr">required</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">data-options</span>=<span class="string">"validType:['CHS','length[2,4]']"</span> <span class="attr">missingMessage</span>=<span class="string">"请输入您的真实姓名"</span> <span class="attr">invalidMessage</span>=<span class="string">"姓名只能是2-4个汉字"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>特别注意：组合验证的时候请使用data-options方式配置数组验证（如上面的实例），不建议采用validType属性方式配置，否则可能不会生效。</p>
</blockquote>
<h3 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h3><p>acooly框架的表单提交采用jquery.form插件方案的ajaxSubmit方法，在ajaxSubmit方法中可以通过beforeSerialize和beforeSubmit完成前置自定义验证，最后提交前会调用EasyUI验证框架验证。</p>
<blockquote>
<p>jquery.form的参考文档请参见：<a href="http://malsup.com/jquery/form/#options-object" target="_blank" rel="noopener">http://malsup.com/jquery/form/#options-object</a></p>
</blockquote>
<p>表单的验证的完整案例请参考：$.acooly.framework.create 封装发放的源代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#formId'</span>).ajaxSubmit(&#123;</span><br><span class="line">	beforeSerialize: <span class="function"><span class="keyword">function</span>(<span class="params">formData,options</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// 序列化form表单值前，可以动态修改表单的值。</span></span><br><span class="line">	&#125;,</span><br><span class="line">	beforeSubmit: <span class="function"><span class="keyword">function</span>(<span class="params">formData, jqForm, options</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// 1、提交前，可以插入自定义的验证</span></span><br><span class="line">		<span class="comment">// 2、最后调用EasyUI的验证框架：$('#formId').form('validate');</span></span><br><span class="line">		<span class="comment">// 3、返回true表示通过，反正为false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	success: <span class="function"><span class="keyword">function</span>（<span class="title">result</span>, <span class="title">statusText</span>）</span>&#123;</span><br><span class="line">		<span class="comment">// ajax请求后的成功响应，如果统一采用acooly框架定义的JsonResult,则模板代码为：</span></span><br><span class="line">		<span class="keyword">if</span> (result.success) &#123;</span><br><span class="line">			<span class="comment">// 成功的处理</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// 失败的处理</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 消息提示，如果有则底部弹出提示框显示。</span></span><br><span class="line">		<span class="keyword">if</span> (result.message) &#123;</span><br><span class="line">			$.messager.show(&#123;<span class="attr">title</span> : <span class="string">'提示'</span>,<span class="attr">msg</span> : result.message&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	error : <span class="function"><span class="keyword">function</span>(<span class="params">XmlHttpRequest, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 统一处理服务器端异常，一般为非200返回情况。</span></span><br><span class="line">		$.messager.alert(<span class="string">'提示'</span>, errorThrown);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上模块代码是ajaxSubmit在acooly中的常规实现，你可以根据需求，参考jquery.form插件的需求进行调整。然后一般通过点击按钮时间调用该方法实现ajax form表单提交。</p>
<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>表单操作中，涉及提交数据自动绑定为domain/entity对象，响应数据（编辑时）domain/entity自动绑定视图表单的功能，这种方式有利于提高高发效率。目前acooly框架中，上送数据的绑定为entity采用的是springMvc的原生解决方案，这里不详细介绍。</p>
<p>在编辑时拉取的entity的属性数据自动绑定视图的表单方案选择的是jodd.form的springside扩展方案：jodd.form taglib。</p>
<ul>
<li><p>实现功能：指定的scope内的实体变量名作为实体数据源，反射实体属性名称，与标签内的表单名称匹配，如果匹配上，则自动为表单赋值为属性值，支持常规的：input和select表单。</p>
</li>
<li><p>用法参考：自动代码生成后的{entity}Edit.jsp视图源代码。</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"manage_customer_editform"</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">jodd:form</span> <span class="attr">bean</span>=<span class="string">"customer"</span> <span class="attr">scope</span>=<span class="string">"request"</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">&lt;!-- 表单 --&gt;</span></span><br><span class="line">      </span><br><span class="line">  <span class="tag">&lt;/<span class="name">jodd:form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="页面框架"><a href="#页面框架" class="headerlink" title="页面框架"></a>页面框架</h2><p>页面框架的封装主要是使用esayui和ztree对后台管理的页面框架整体的结构，基础功能的封装，包括整体布局，两级菜单的显示，logo，系统功能等。这里不做详细的介绍，如有兴趣，请参见源代码。</p>
<ul>
<li>/manage/assert/script/acooly.system.js</li>
<li>/manage/assert/script/acooly.layout.js</li>
<li>/manage/assert/script/acooly.portal.js</li>
</ul>
<h1 id="案例经验"><a href="#案例经验" class="headerlink" title="案例经验"></a>案例经验</h1><h2 id="标准CRUD"><a href="#标准CRUD" class="headerlink" title="标准CRUD"></a>标准CRUD</h2><p>请参考：自动代码生成的代码。所有自动代码生成的单实体的功能包含了网站的CRUD功能。</p>
<h2 id="分类管理"><a href="#分类管理" class="headerlink" title="分类管理"></a>分类管理</h2><p>分类管理在后台管理开发中是比较常见的场景。从数据结构上来看，首先有一个多级或无限极的分类实体，然后由一个具体分类下管理的主体实体。所以在这种场景下，我们需要管理的是2个实体,但是在视图上，我们习惯采用单个整合视图来操作个管理更符合人类习惯。</p>
<p>请参考：acooly-showcase中: <strong>商户管理（树型）</strong>功能。</p>
<h2 id="主从管理"><a href="#主从管理" class="headerlink" title="主从管理"></a>主从管理</h2><p>主要应对场景为一个主表对应多个子表的协调管理。例如客户管理，主表为客户主信息表，可能存在多个客户子表，例如：客户基础信息，客户联系信息，客户认证信息，客户扩展信息等。</p>
<p>该案例主要展示在该场景下的主要特性处理方案：</p>
<ul>
<li>主对象的管理（CRUD，分页查询，导入和导出）</li>
<li>独立加载单和子tab，防止同时加载全部和重复加载。</li>
<li>tab内的子模块的管理</li>
</ul>
<p>请参考：acooly-showcase中:<strong>客户管理(父子)</strong>功能。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/07/06/服务应用/2017-06-23-NFS常规配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/06/服务应用/2017-06-23-NFS常规配置/" itemprop="url">NFS常规配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-06T00:53:53+08:00">
                2017-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CentOS或Redhat 6.x的常规NFS共享服务配置和客户端挂载。</p>
<h2 id="NFS服务"><a href="#NFS服务" class="headerlink" title="NFS服务"></a>NFS服务</h2><h3 id="查看是否安装"><a href="#查看是否安装" class="headerlink" title="查看是否安装"></a>查看是否安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep nfs</span><br><span class="line">rpm -qa|grep rpcbind</span><br></pre></td></tr></table></figure>
<p>如果以上两个命令执行后都没有查询出对应的已安装包，说明没有安装。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>一般最简单采用yum方式安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nfs-utils</span><br></pre></td></tr></table></figure>
<p>安装完成后，可以使用前面检查是否安装的命令验证。</p>
<h3 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/media</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/data/media 192.168.1.*(rw,no_root_squash)"</span> &gt;&gt; /etc/exports</span><br><span class="line"></span><br><span class="line"><span class="comment"># 独立启动</span></span><br><span class="line">/etc/init.d/rpcbind start</span><br><span class="line">/etc/init.d/nfslock start</span><br><span class="line">/etc/init.d/nfs start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务自动启动配置</span></span><br><span class="line">chkconfig rpcbind on</span><br><span class="line">chkconfig nfslock on</span><br><span class="line">chkconfig nfs on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防火墙打开</span></span><br><span class="line">iptables -t filter -A INPUT -s 172.16.3.0/24 -m state --state NEW -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新验证</span></span><br><span class="line">service nfs stop</span><br><span class="line">service nfs start</span><br></pre></td></tr></table></figure>
<p>NFS服务主要是通过配置/etc/exports文件，对本地目录暴露问NFS共享服务。主要用于共享配置选项包括：</p>
<ul>
<li>ro：只读；</li>
<li>rw：读写；</li>
<li>sync ：同步模式，内存中数据时时写入磁盘；</li>
<li>async ：不同步，把内存中数据定期写入磁盘中；</li>
<li>no_root_squash ：加上这个选项后，root用户就会对共享的目录拥有至高的权限控制，就像是对本机的目录操作一样。不安全，不建议使用；</li>
<li>root_squash：和上面的选项对应，root用户对共享目录的权限不高，只有普通用户的权限，即限制了root；</li>
<li>all_squash：不管使用NFS的用户是谁，他的身份都会被限定成为一个指定的普通用户身份；</li>
<li>anonuid/anongid ：要和root_squash以及all_squash一同使用，用于指定使用NFS的用户限定后的uid和gid，前提是本机的/etc/passwd中存在这个uid和gid。</li>
</ul>
<h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><pre><code class="sh"><span class="comment"># 安装</span>
yum install -y nfs-utils  
<span class="comment"># 查看共享目录              </span>
showmount -e 172.16.3.8           
<span class="comment"># 挂载命令 </span>
mount -t nfs 172.16.3.8:/data/media /data/media  

<span class="comment"># 建议添加挂载到/etc/fstab，便于重启时自动挂载。</span>
<span class="built_in">echo</span> <span class="string">"172.16.3.8:/data/media /data/media       nfs     defaults        0 0 "</span> &gt;&gt; /etc/fstab
mount /data/media
</code></pre>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/05/01/服务应用/2016-07-1-nginx+tomcat的https卸载配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/01/服务应用/2016-07-1-nginx+tomcat的https卸载配置/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-01T13:21:22+08:00">
                2017-05-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="nginx-tomcat的https卸载配置"><a href="#nginx-tomcat的https卸载配置" class="headerlink" title="nginx+tomcat的https卸载配置"></a>nginx+tomcat的https卸载配置</h1><h2 id="场景说明"><a href="#场景说明" class="headerlink" title="场景说明"></a>场景说明</h2><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteIpValve"</span></span></span><br><span class="line"><span class="tag"><span class="attr">remoteIpHeader</span>=<span class="string">"X-Forwarded-For"</span></span></span><br><span class="line"><span class="tag"><span class="attr">protocolHeader</span>=<span class="string">"X-Forwarded-Proto"</span></span></span><br><span class="line"><span class="tag"><span class="attr">protocolHeaderHttpsValue</span>=<span class="string">"https"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/04/22/linux/2015-12-14-linux_online/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/22/linux/2015-12-14-linux_online/" itemprop="url">linux java生产环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-22T14:54:41+08:00">
                2017-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本日志主要针对基于java web的项目部署生成环境搭建的操作。在安装配置目标服务器环境前，对OS和基础环境做基本设计和配置。</p>
<h1 id="OS环境"><a href="#OS环境" class="headerlink" title="OS环境"></a>OS环境</h1><h2 id="信任登录"><a href="#信任登录" class="headerlink" title="信任登录"></a>信任登录</h2><p>1、在A机器，使用一下命令一路回传后，生成秘钥对在：~/.ssh下，有：id_rsa,id_rsa.pub,know_hosts</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>2、使用scp拷贝id_rsa.pub到B机器的：~/.ssh下，并添加内容到authorized_keys文件中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>
<p>3、完成后测试，在A机器可以免密码访问B机器，包括ssh,scp等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@B机器</span><br></pre></td></tr></table></figure>
<h2 id="查看最新变动和新增的文件"><a href="#查看最新变动和新增的文件" class="headerlink" title="查看最新变动和新增的文件"></a>查看最新变动和新增的文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当天变动文件</span></span><br><span class="line">find /data/media -mtime -1 -<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一日以前的</span></span><br><span class="line">find / -mtime +1 -<span class="built_in">print</span></span><br></pre></td></tr></table></figure>
<h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p>下面的命令是linux较好用的生成密码的命令。12位</p>
<pre><code>cat /dev/urandom | tr -dc &quot;a-zA-Z0-9_+\~\!\@\#\$\%\^\&amp;\*\(\)&quot;| fold -w 12 |head -n 12
...
passwd
...
</code></pre><h2 id="修改硬盘挂载点。"><a href="#修改硬盘挂载点。" class="headerlink" title="修改硬盘挂载点。"></a>修改硬盘挂载点。</h2><pre><code>df -h
# 查看现在的挂载情况
vim /etc/fstab
# 修改挂载的目录，并保存退出
# umount 原挂载目录
# mount 新挂载目录
</code></pre><h2 id="修改机器名称"><a href="#修改机器名称" class="headerlink" title="修改机器名称"></a>修改机器名称</h2><pre><code>hostname newHostName
vi /etc/sysconfig/network
# 修改或增加配置：hostname=newHostName
vi /etc/hosts
# 修改对应的本地HOST映射
# xx.xxx.xxx.xxx newHostName
</code></pre><h2 id="时间同步服务ntp-server"><a href="#时间同步服务ntp-server" class="headerlink" title="时间同步服务ntp-server"></a>时间同步服务ntp-server</h2><p>请参考： <a href="http://acooly.iteye.com/blog/1993484" target="_blank" rel="noopener">NTP服务及时间同步(CentOS6.x)</a>.</p>
<h2 id="SSH常用配置"><a href="#SSH常用配置" class="headerlink" title="SSH常用配置"></a>SSH常用配置</h2><p>ssh的常规配置一般都需要修改：/etc/ssh_config配置文件。</p>
<h3 id="修改端口"><a href="#修改端口" class="headerlink" title="修改端口"></a>修改端口</h3><pre><code>查找到#Port 22字段删掉#，将22改为其他不被使用的端口。如：23987, 22223,22225等
</code></pre><h3 id="禁用root登录，使用普通用户登录。"><a href="#禁用root登录，使用普通用户登录。" class="headerlink" title="禁用root登录，使用普通用户登录。"></a>禁用root登录，使用普通用户登录。</h3><pre><code>vim /etc/ssh/sshd_config
#查找“#PermitRootLogin yes”，将前面的“#”去掉，短尾“Yes”改为“No”，并保存文件退出(:wq)
</code></pre><p>注意，禁用root后，需要建立普通用户登录：</p>
<pre><code>groupadd operator
useradd -g operator -G operator optuser
passwd optuser
# ....
</code></pre><h3 id="修改自动断开时间"><a href="#修改自动断开时间" class="headerlink" title="修改自动断开时间"></a>修改自动断开时间</h3><p>很多时候，登入ssh后，不希望一会（1-2分钟）没有操作终端的ssh就自动断开，则需要配置一下参数。</p>
<pre><code>找到下面两行
#ClientAliveInterval 0
#ClientAliveCountMax 3
去掉注释，改成
ClientAliveInterval 30
ClientAliveCountMax 86400
这两行的意思分别是
1、客户端每隔多少秒向服务发送一个心跳数据
2、客户端多少秒没有相应，服务器自动断掉连接
</code></pre><blockquote>
<p>注意：ssh的配置修改后，需要重新启动ssh服务：service sshd restart</p>
</blockquote>
<h2 id="锁定系统中多余的自建帐号"><a href="#锁定系统中多余的自建帐号" class="headerlink" title="锁定系统中多余的自建帐号"></a>锁定系统中多余的自建帐号</h2><pre><code># 用户名文件
cat /etc/passwd
# 用户密码信息
cat /etc/shadow

#操作前注意先备份
cp /etc/passwd 
/etc/passwd_bak
#...
</code></pre><p>###评估：</p>
<blockquote>
<p>如果passwd中的用户信息后面跟有/sbin/nologin,则表示该用户无法登陆系统，有密码也不行。同时密码文件shadow中，如果第二个字段是”!”也表示不能登陆。所有大部分系统用户（如：）是不能登陆的。可以通过以下命令查找。</p>
</blockquote>
<pre><code>cat /etc/passwd |grep /sbin/nologin -c
20
wc /etc/passwd
26
</code></pre><blockquote>
<p>对比查看可以登录用户个数。在针对判断这剩余的可登录的用户，在shadow文件中是否设置密码可登录。如（sync，shutdown，halt）</p>
</blockquote>
<pre><code>cat /etc/shadow |grep halt
</code></pre><blockquote>
<p>如果第二个字段含有不属于集合{./0-9A-Za-z}中的字符，则对应的用户不能登录。</p>
</blockquote>
<p>###处理<br>如果出现异常的用户，可以使用命令进行锁定处理。</p>
<ol><br><li>passwd -l &lt;用户名&gt;锁定不必要的账号</li><br><li>passwd -u &lt;用户名&gt;解锁需要恢复的账号</li><br></ol>

<h2 id="设置系统口令策略"><a href="#设置系统口令策略" class="headerlink" title="设置系统口令策略"></a>设置系统口令策略</h2><p>###检查：<br>    [root@test ~]# cat /etc/login.defs|grep PASS</p>
<pre><code>#    PASS_MAX_DAYS    Maximum number of days a password may be used.
#    PASS_MIN_DAYS    Minimum number of days allowed between password changes.
#    PASS_MIN_LEN    Minimum acceptable password length.
#    PASS_WARN_AGE    Number of days warning given before a password expires.
PASS_MAX_DAYS    99999
PASS_MIN_DAYS    0
PASS_MIN_LEN    5
PASS_WARN_AGE    7
</code></pre><p>###备份：<br>    cp -p /etc/login.defs /etc/login.defs_bak</p>
<p>###加固：</p>
<pre><code>#vi /etc/login.defs 
</code></pre><p>修改配置文件:</p>
<ol>
<li>PASS_MAX_DAYS 90  #新建用户的密码最长使用天数</li>
<li>PASS_MIN_DAYS 0   #新建用户的密码最短使用天数</li>
<li>PASS_WARN_AGE 7   #新建用户的密码到期提前提醒天数</li>
<li>PASS_MIN_LEN 12   #最小密码长度12</li>
</ol>
<h2 id="检查空口令帐号"><a href="#检查空口令帐号" class="headerlink" title="检查空口令帐号"></a>检查空口令帐号</h2><p>###检查：</p>
<blockquote>
<p>密码为空的情况，在shadow文件中的第二列为空，通过以下命名检查</p>
</blockquote>
<pre><code>cat /etc/shadow |awk -F &apos;:&apos; &apos;($2 == &quot;&quot;) {print}&apos;
optuser1::16529:0:99999:7:::
</code></pre><p>###处理<br><em>我们可以看到出现有一个没有设置密码的用户optuser1,这种情况需要对该用户进行处理，处理方法可以是强制设置密码或删除用户。</em></p>
<pre><code># 删除用户
userdel optuser1
# 设置密码
passwd optuser1
...
</code></pre><blockquote>
<p>特别的，如果想模拟空用户，可以进行如下操作：</p>
</blockquote>
<pre><code>useradd -g groupName -G groupName testuser*
useradd -uf testuser*
</code></pre><h2 id="YUM配置和使用"><a href="#YUM配置和使用" class="headerlink" title="YUM配置和使用"></a>YUM配置和使用</h2><p>一般redhat或centOS的时候，直接采用yum方式安装一些必须的软件包是最方便的方式。yum可以解决软件包依存问题，更便于管理大量的系统更新问题。它可以同时配置多个仓库或叫资源库(repository)</p>
<blockquote>
<p>默认情况下yum的配置是直接连接互联网的远程官方或指定专用服务器查询或获取软件包。这会有一些问题，如果目标环境无法上网或网络较慢就会影响配置工作，建议一般在本地或本机局域网搭建安装源用户yum方式安装支持。</p>
</blockquote>
<p>仓库(repository)的配置，默认是链接到发行方指定的镜像地址，一般在国外，就一个字：慢。所以，一般在系统部署时，会选择一下几种方式自定义配置yum的源仓库。</p>
<h3 id="配置仓库"><a href="#配置仓库" class="headerlink" title="配置仓库"></a>配置仓库</h3><p>仓库的配置文件在/etc/yum.repo.d下，自己可以建立一个配置文件。如：CentOS-base-xx.repo (yum会自动生效)</p>
<pre><code>常用文件格式说明：
[base]
name=CentOS-6-Base-xxx

# http方式
baseurl=http://mirrors.163.com/centos/6/os/$basearch/   
# 本地文件方式（包括NFS挂载）
baseurl=file:///media/...
# ftp方式
baseurl=ftp://192.168.0.x/...

# 是否可用开关
enabled=1
# 表示是否打开本地安装文件校验。我一般关闭，简单点，因为一般情况下你自己知道的安装源是否安全。
gpgcheck=1    
# gpgcheck对应的秘钥文件
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
</code></pre><h4 id="本地仓库"><a href="#本地仓库" class="headerlink" title="本地仓库"></a>本地仓库</h4><p>拷贝本地安装光盘到服务器，指定为安装仓库源,使用NFS方式进行局域网共享，每台服务器mount到本地设置yum配置文件或者使用FTP方式共享。最快哈哈。（不能上公网的情况最好使用这种）</p>
<pre><code>[base]
name=CentOS-6-Base-xxx 
# 本地文件方式（包括NFS挂载）
baseurl=file:///media/...
# 是否可用开关
enabled=1
# 表示是否打开本地安装文件校验。我一般关闭，简单点，因为一般情况下你自己知道的安装源是否安全。
gpgcheck=1    
# gpgcheck对应的秘钥文件
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
</code></pre><h4 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h4><p>找一个国内的公共安装源（能上公网），如163镜像等，配置为通过http方式。</p>
<pre><code>[base]
name=CentOS-6-Base-xxx 
# http方式
baseurl=http://mirrors.163.com/centos/6/os/$basearch/ 
# 是否可用开关
enabled=1
# 表示是否打开本地安装文件校验。我一般关闭，简单点，因为一般情况下你自己知道的安装源是否安全。
gpgcheck=1    
# gpgcheck对应的秘钥文件
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
</code></pre><p>完整文件参考（来源：西部数码云服务器CentOS6.4）:</p>
<pre><code>[base]
name=CentOS-6 - Base - 163.com
baseurl=http://mirrors.163.com/centos/6/os/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6

#released updates 
[updates]
name=CentOS-6 - Updates - 163.com
baseurl=http://mirrors.163.com/centos/6/updates/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6

#packages used/produced in the build but not released
#additional packages that may be useful
[extras]
name=CentOS-6 - Extras - 163.com
baseurl=http://mirrors.163.com/centos/6/extras/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
</code></pre><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li>yum search xxx</li>
<li>yum install xxx</li>
<li>yum update xxx</li>
<li>yum remove xxx</li>
</ul>
<h1 id="常见问题处理"><a href="#常见问题处理" class="headerlink" title="常见问题处理"></a>常见问题处理</h1><h2 id="查看linux服务CPU位数"><a href="#查看linux服务CPU位数" class="headerlink" title="查看linux服务CPU位数"></a>查看linux服务CPU位数</h2><pre><code># uname -a
Linux iZ23ibjdhg1Z 2.6.32-431.23.3.el6.x86_64 #1 SMP Thu Jul 31 17:20:51 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><p>如果包含“x86_64”则表示是64位服务器。</p>
<ul>
<li>如果是64位服务器，一般可以支持的最大堆内存可以配置为4G</li>
<li>如果是32位服务器，一般可以支持的最大堆内存可以配置为2G</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/04/21/服务应用/2015-12-21-rsync同步文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/21/服务应用/2015-12-21-rsync同步文件/" itemprop="url">rsync同步数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T23:36:35+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务应用/" itemprop="url" rel="index">
                    <span itemprop="name">服务应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>rsync是类unix系统下的数据镜像备份工具。本文以Nexue数据备份的实践应用为案例，介绍整个应用过程。作为入门材料，rsync的高级配置和应用不在本文范畴。</p>
<p><strong>功能及特点</strong></p>
<ul>
<li>可以镜像保存整个目录树和文件系统。</li>
<li>可以很容易做到保持原来文件的权限、时间、软硬链接等等。</li>
<li>无须特殊权限即可安装。</li>
<li>快速：第一次同步时 rsync 会复制全部内容，但在下一次只传输修改过的文件。rsync 在传输数据的过程中可以实行压缩及解压缩操作，因此可以使用更少的带宽。</li>
<li>安全：可以使用scp、ssh等方式来传输文件，当然也可以通过直接的socket连接。</li>
<li>支持匿名传输，以方便进行网站镜象。</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li>服务器数据备份</li>
<li>集群服务器中数据同步（增量是亮点啊）</li>
</ul>
<blockquote>
<p>官方网站：<a href="http://rsync.samba.org/" target="_blank" rel="noopener">http://rsync.samba.org/</a></p>
</blockquote>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync通过ssh作为通道，进行拷贝同步。</span></span><br><span class="line"><span class="comment"># -r:递归,-u:增量</span></span><br><span class="line">rsync -rvzu -e <span class="string">'ssh -p 23987'</span> --progress  optuser@source.domain.com:/data/media/ /data/media/</span><br></pre></td></tr></table></figure>
<h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><p>rsync是应用模式是标准的C/S模式，原始数据所在的服务器A作为服务器，其他备份和同步的服务器B为客户端。所以分为服务器端配置和客户端配置。方案规划如下：</p>
<table>
<thead>
<tr>
<th>角色</th>
<th>名称</th>
<th>IP</th>
<th>用户</th>
<th>目录        </th>
</tr>
</thead>
<tbody>
<tr>
<td>服务端</td>
<td>服务器A</td>
<td>192.168.30.202</td>
<td>root</td>
<td>/data/sonatype-work</td>
</tr>
<tr>
<td>服务端</td>
<td>服务器B</td>
<td>192.168.30.208</td>
<td>root</td>
<td>/data/sonatype-work</td>
</tr>
</tbody>
</table>
<h4 id="rsync安装"><a href="#rsync安装" class="headerlink" title="rsync安装"></a>rsync安装</h4><p>rsync的安装，服务器端和客户端完全相同。</p>
<p><strong>源代码安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，如果文件不存在，则直接访问http://rsync.samba.org/ftp/rsync/目录查看最新版本</span></span><br><span class="line">wget http://rsync.samba.org/ftp/rsync/rsync-3.1.1.tar.gz</span><br><span class="line">tar -xzvf rsync-3.1.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> rsync-3.1.1</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p><strong>yum安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：编译安装需要gcc支持，如果没有安装，请先安装。我使用的是centOS6.3，所以就直接:yum install gcc.就OK了。</p>
</blockquote>
<p>OK，安装完成。</p>
<h4 id="服务端配置-服务器A"><a href="#服务端配置-服务器A" class="headerlink" title="服务端配置(服务器A)"></a>服务端配置(服务器A)</h4><p>服务器端的需求是通过rsync提供对/data/sonatype-work目录的同步备份服务，同时要求服务器启动自动启动服务。rsync配置主要通过3个配置文件配置完成。如下：</p>
<blockquote>
<p>这个三个配置文件默认不存在，需手动建立</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line">touch rsyncd.conf</span><br><span class="line">touch rsyncd.motd</span><br><span class="line">touch rsyncd.secrets</span><br><span class="line">chmod 600 rsyncd.secrets</span><br><span class="line">ll rsyncd.*</span><br><span class="line">-rw-r--r-- 1 root root 918 Mar  6 22:44 rsyncd.conf</span><br><span class="line">-rw-r--r-- 1 root root 191 Mar  6 22:06 rsyncd.motd</span><br><span class="line">-rw------- 1 root root  14 Mar  6 22:04 rsyncd.secrets</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意啦，无论客户端还是服务端，rsyncd.secrets文件的权限都需要为600（属主外不能访问）</p>
</blockquote>
<ul>
<li><strong>rsyncd.conf</strong>：主配置文件，配置rsync服务的公共参数（IP,端口，进程文件，IP限制，日志，连接超时等）和需要同步的模块（需要同步的目录及常规参数）</li>
<li><strong>rsyncd.secrets</strong>：客户端请求同步时的账户安全认证文件。类似samba的模式（user:passwsord[明文哈]），这个文件的需要特别注意权限设置为宿主可访问才行（chmod 600 rsyncd.secrets）。</li>
<li><strong>rsyncd.motd</strong>：该文件就是客户端请求上来的时候，立即回复的欢迎信息，就和FTP登录时显示差不多意思。</li>
</ul>
<p>下面我们分配配置和说明这些配置文件。</p>
<p><strong>rsyncd.conf</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"># Minimal configuration <span class="keyword">file</span> <span class="keyword">for</span> rsync daemon</span><br><span class="line"># See rsync(<span class="number">1</span>) <span class="built_in">and</span> rsyncd.<span class="keyword">conf</span>(<span class="number">5</span>) man pages <span class="keyword">for</span> <span class="keyword">help</span></span><br><span class="line"></span><br><span class="line">##################################### 以下是公共参数配置 #############################################</span><br><span class="line"># This <span class="built_in">line</span> <span class="keyword">is</span> required by the /etc/init.d/rsyncd script</span><br><span class="line">pid <span class="keyword">file</span> = /var/run/rsyncd.pid</span><br><span class="line"># 服务的端口</span><br><span class="line">port = <span class="number">873</span></span><br><span class="line"># 服务的IP</span><br><span class="line">address = <span class="number">192.168</span>.<span class="number">30.202</span>  </span><br><span class="line"># 运行的宿主账户，这里为简单就root了</span><br><span class="line">uid = root   </span><br><span class="line">gid = root  </span><br><span class="line"># 这个参数复杂，有空去查查。打开（yes）后有个功能是让符号链接可以同步过去（不通过符号链接对应的实际文件）</span><br><span class="line">use chroot = yes</span><br><span class="line"># 客户端只读</span><br><span class="line"><span class="keyword">read</span> <span class="keyword">only</span> = yes</span><br><span class="line">#limit access <span class="keyword">to</span> private LANs</span><br><span class="line">hosts allow=<span class="number">192.168</span>.<span class="number">30.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">hosts deny=*</span><br><span class="line"># 最大连接数</span><br><span class="line"><span class="built_in">max</span> connections = <span class="number">5</span> </span><br><span class="line"># 欢迎信息对应的文件</span><br><span class="line">motd <span class="keyword">file</span> = /etc/rsyncd.motd</span><br><span class="line"># 客户端链接的超时时间</span><br><span class="line">timeout = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"># 以下是日志相关配置，可选使用独立日志文件和系统日志，这里选择的是系统日志（/var/<span class="built_in">log</span>/message）</span><br><span class="line"># This will give you <span class="keyword">a</span> separate <span class="built_in">log</span> <span class="keyword">file</span></span><br><span class="line"># <span class="built_in">log</span> <span class="keyword">file</span> = /var/<span class="built_in">log</span>/rsync.<span class="built_in">log</span></span><br><span class="line"># This will <span class="built_in">log</span> every <span class="keyword">file</span> transferred - <span class="keyword">up</span> <span class="keyword">to</span> <span class="number">85</span>,<span class="number">000</span>+ per user, per <span class="keyword">sync</span></span><br><span class="line"># transfer logging = yes</span><br><span class="line"><span class="built_in">log</span> format = %t %<span class="keyword">a</span> %<span class="keyword">m</span> %<span class="keyword">f</span> %<span class="keyword">b</span></span><br><span class="line">syslog facility = local3</span><br><span class="line"></span><br><span class="line">##################################### 同步模块配置 #############################################</span><br><span class="line">[nexus]</span><br><span class="line"># 需要同步的路径</span><br><span class="line">path = /data/sonatype-work</span><br><span class="line"># 客户端可以使用<span class="keyword">list</span>命令列表显示</span><br><span class="line"><span class="keyword">list</span>=yes</span><br><span class="line"># 忽略错误</span><br><span class="line">ignore errors</span><br><span class="line"># 认证用户</span><br><span class="line">auth users = root</span><br><span class="line"># 认证使用的账户密码文件</span><br><span class="line">secrets <span class="keyword">file</span> = /etc/rsyncd.secrets</span><br><span class="line"># 备注信息</span><br><span class="line">comment = This <span class="keyword">is</span> nexus data</span><br><span class="line"># 如果有忽略的子目录，可以通过exclude定义</span><br><span class="line"># exclude = easylife/  samba/</span><br></pre></td></tr></table></figure>
<p><strong>rsyncd.secrets</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 用户名:密码明文了</span><br><span class="line">roo<span class="variable">t:1qaz</span>@WSX</span><br></pre></td></tr></table></figure>
<p><strong>rsyncd.motd</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">　　      Welcome <span class="keyword">to</span> Nexus rsync services</span><br><span class="line">           <span class="number">2012</span>--<span class="number">2013</span> create by zhangpu</span><br><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br></pre></td></tr></table></figure>
<p><strong>防火墙</strong><br>如果你开启了操作系统的防火墙，请使用iptables配置873端口可用。我反反正是直接关闭了(我的多数环境通过上层防火墙管控)，简单点。</p>
<p><strong>启动服务</strong></p>
<p>手动方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## --config用于指定rsyncd.conf的位置,如果在/etc下可以不写</span></span><br><span class="line">/usr/bin/rsync --daemon  --config=/etc/rsyncd.conf</span><br></pre></td></tr></table></figure>
<p>xinetd方式:<br>如果没有安装xinet，请先安装，对应本系统（CentOS）,我直接 yum install xinet 就OK了<br>在rsync默认安装完成后，安装程序会自动在建立/etc/xinetd.d/rsync文件，但是默认情况是disable = yes（也就是不可用的），需要修改为disable=no 即可<br>然后，我们通过xinet启动rsync:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service xinetd start/restart</span><br></pre></td></tr></table></figure>
<p>测试下，可以查看进程，端口监听等，我还是喜欢最笨最原始的方式：telnet,哈哈!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.30.202 873</span><br><span class="line">Trying 192.168.30.202...</span><br><span class="line">Connected to 192.168.30.202 (192.168.30.202).</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">@RSYNCD: 30.0</span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">　　      Welcome to Nexus rsync services</span><br><span class="line">           2012--2013 create by zhangpu</span><br><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br></pre></td></tr></table></figure>
<p>都看到欢迎界面了，肯定服务起来了。</p>
<h4 id="客户端配置（服务器B）"><a href="#客户端配置（服务器B）" class="headerlink" title="客户端配置（服务器B）"></a>客户端配置（服务器B）</h4><p>客户端是备份服务器，负责使用rsync命令从服务器备份或同步数据到本地指定目录。这里使用crontab+rsync实现定时自动增量同步的功能。<br>我决定在/data/rsync下建立一个脚本来实现启动rsync同步的功能，然后再使用crontab来实现定时调度。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /data/rsync/rsyncd.secrets</span><br><span class="line">ll /data/rsync</span><br><span class="line">total 8</span><br><span class="line">-rwxr-xr-x 1 root root 177 Mar  6 15:27 rsync_client_nexus.sh</span><br><span class="line">-rwx------ 1 root root   9 Mar  6 15:17 rsyncd.secrets</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意啦，无论客户端还是服务端，rsyncd.secrets文件的权限都需要为600（属主外不能访问）</p>
</blockquote>
<p><strong>rsync_client_nexus.sh</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/<span class="keyword">sh</span></span><br><span class="line"># backup <span class="number">192.168</span>.<span class="number">30.202</span> nexus data with rysnc</span><br><span class="line"># 参数说明：</span><br><span class="line"># -avzP表示归档，压缩并显示进度；</span><br><span class="line"># --<span class="keyword">delete</span>表示如果服务端删除的文件，客户端也需要删除；</span><br><span class="line"># --password-<span class="keyword">file</span>: 指定用户密码文件，不用用户交互输入。</span><br><span class="line"># root@<span class="number">192.168</span>.<span class="number">30.202</span>::nexus 表示：使用root用户访问<span class="number">192.168</span>.<span class="number">30.202</span>的nexus模块，‘::’表示从服务器端拷贝数据</span><br><span class="line"># /data/sonatype-work ： 本地保存同步文件的目录。</span><br><span class="line">/usr/bin/rsync -avzP --<span class="keyword">delete</span> --password-<span class="keyword">file</span>=/data/rsync/rsyncd.secrets root@<span class="number">192.168</span>.<span class="number">30.202</span>::nexus /data/sonatype-work</span><br></pre></td></tr></table></figure>
<p><strong>rsyncd.secrets</strong><br>该文件保存rsync命令中使用的用户名的密码明文，这里就是上面的root用户的密码。同时注意这里和服务器端一样，该文件的权限为宿主可以读写（chmod 600 rsyncd.secrets）</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## root（rsync的，非操作系统）用户的密码</span><br><span class="line"><span class="number">1</span>qaz@WSX</span><br></pre></td></tr></table></figure>
<p><strong>定时处理</strong><br>crontab配置<br>这是配置每天凌晨1点1分进行同步处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">1 1 * * * /data/rsync/rsync_client_nexus.sh   1&gt; /dev/null</span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>测试就比较简单了，在服务器A的/data/sonatype-work下建立一个testfile,随便输入些东西，然后在服务器B中手动运行同步脚本rsync_client_nexus.sh</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/04/20/database/mysql/MySQL备份和还原/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/20/database/mysql/MySQL备份和还原/" itemprop="url">MySQL备份和还原</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T17:16:26+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>记录MySQL常用的备份和还原方案和操作。</p>
<h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><h3 id="常规方案"><a href="#常规方案" class="headerlink" title="常规方案"></a>常规方案</h3><h4 id="mysqldump备份"><a href="#mysqldump备份" class="headerlink" title="mysqldump备份"></a>mysqldump备份</h4><p>mysqldump</p>
<h4 id="命令还原"><a href="#命令还原" class="headerlink" title="命令还原"></a>命令还原</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/04/20/database/mysql/2015-12-11-mysql_binlog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/20/database/mysql/2015-12-11-mysql_binlog/" itemprop="url">mysql binlog简介和命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T17:10:50+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>binlog,即二进制日志,它记录了数据库上的所有改变.改变数据库的SQL语句执行结束时,将在binlog的末尾写入一条记录,同时通知语句解析器,语句执行完毕.</p>
<p>binlog格式：</p>
<ul>
<li>基于语句,无法保证所有语句都在从库执行成功,比如update … limit 1;</li>
<li>基于行,将每一次改动记为binlog中的一行.在执行一个特别复杂的update或者delete操作时,基于行的格式会有优势.</li>
</ul>
<h3 id="服务命令"><a href="#服务命令" class="headerlink" title="服务命令"></a>服务命令</h3><p>只查看第一个binlog文件的内容</p>
<pre><code>show binlog events;
</code></pre><p>查看指定binlog文件的内容</p>
<pre><code>show binlog events in &apos;mysql-bin.000002&apos;;
</code></pre><p>查看当前正在写入的binlog文件</p>
<pre><code>show master status\G
</code></pre><p>获取binlog文件列表</p>
<pre><code>show binary logs;
</code></pre><h2 id="查看命令"><a href="#查看命令" class="headerlink" title="查看命令"></a>查看命令</h2><blockquote>
<p>注意:</p>
</blockquote>
<ul>
<li>不要查看当前正在写入的binlog文件</li>
<li>不要加–force参数强制访问</li>
<li>如果binlog格式是行模式的,请加 -vv参数</li>
</ul>
<h3 id="本地查看"><a href="#本地查看" class="headerlink" title="本地查看"></a>本地查看</h3><p>基于开始/结束时间</p>
<pre><code>mysqlbinlog --start-datetime=&apos;2013-09-10 00:00:00&apos; --stop-datetime=&apos;2013-09-10 01:01:01&apos; -d 库名 二进制文件
</code></pre><p>基于pos值</p>
<pre><code>mysqlbinlog --start-postion=107 --stop-position=1000 -d 库名 二进制文件
</code></pre><h3 id="远程查看"><a href="#远程查看" class="headerlink" title="远程查看"></a>远程查看</h3><p>指定开始/结束时间,并把结果重定向到本地t.binlog文件中.</p>
<pre><code>mysqlbinlog -u username -p password -hl-db1.dba.beta.cn6.qunar.com -P3306 \
--read-from-remote-server --start-datetime=&apos;2013-09-10 23:00:00&apos; --stop-datetime=&apos;2013-09-10 23:30:00&apos; mysql-bin.000001 &gt; t.binlog
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://acooly.github.io/2017/04/19/工具技巧/2015-12-19-aliyun_disk_init/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhang pu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Acooly's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/19/工具技巧/2015-12-19-aliyun_disk_init/" itemprop="url">Aliyun新数据磁盘初始化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-19T16:45:40+08:00">
                2017-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>针对购买阿里云ECS，有额外购买数据磁盘的情况，我们需要先进入操作系统（linux）初始化后才能使用。需要三部：分区、格式化、挂载</p>
<h2 id="快速命令查询"><a href="#快速命令查询" class="headerlink" title="快速命令查询"></a>快速命令查询</h2><h2 id="高速云盘"><a href="#高速云盘" class="headerlink" title="高速云盘"></a>高速云盘</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"><span class="comment"># h,n,p,1,回车,回车,w</span></span><br><span class="line">fdisk /dev/xvdb</span><br><span class="line">mkfs.ext4 /dev/xvdb1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/dev/xvdb1  /data ext4    defaults    0  0'</span> &gt;&gt; /etc/fstab</span><br><span class="line">mount /data</span><br><span class="line"><span class="comment"># 检查</span></span><br><span class="line">cat /etc/fstab</span><br><span class="line"><span class="built_in">cd</span> /data</span><br></pre></td></tr></table></figure>
<h2 id="SSD盘"><a href="#SSD盘" class="headerlink" title="SSD盘"></a>SSD盘</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"><span class="comment"># h,n,p,1,回车,回车,w</span></span><br><span class="line">fdisk /dev/vdb</span><br><span class="line">mkfs.ext4 /dev/vdb1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/dev/vdb1  /data ext4    defaults    0  0'</span> &gt;&gt; /etc/fstab</span><br><span class="line">mount /data</span><br><span class="line"><span class="comment"># 检查</span></span><br><span class="line">cat /etc/fstab</span><br><span class="line"><span class="built_in">cd</span> /data</span><br></pre></td></tr></table></figure>
<h2 id="详细操作及说明"><a href="#详细操作及说明" class="headerlink" title="详细操作及说明"></a>详细操作及说明</h2><h3 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h3><p>首先使用fdisk命令查看下未挂载的设备</p>
<p>fidks -l</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/xvda: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00078f9c</span><br><span class="line"></span><br><span class="line">Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/xvda1   *           1        2611    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: 107.4 GB, 107374182400 bytes</span><br><span class="line">255 heads, 63 sectors/track, 13054 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br></pre></td></tr></table></figure>
<p>上面命令结果中的如下行，说明有设备：/dev/xvdb,大小100G<br>Disk /dev/xvdb: 107.4 GB, 107374182400 bytes</p>
<p>然后执行分区命令，开始分区<br>首先在命令提示后输入：h，查看帮助，如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/xvdb</span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">…………</span><br><span class="line">switch off the mode (<span class="built_in">command</span> <span class="string">'c'</span>) and change display units to sectors (<span class="built_in">command</span> <span class="string">'u'</span>).</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): h</span><br><span class="line">h: unknown <span class="built_in">command</span></span><br><span class="line">Command action</span><br><span class="line">   a   toggle a bootable flag</span><br><span class="line">   b   edit bsd disklabel</span><br><span class="line">   c   toggle the dos compatibility flag</span><br><span class="line">   d   delete a partition</span><br><span class="line">   l   list known partition types</span><br><span class="line">   m   <span class="built_in">print</span> this menu</span><br><span class="line">   n   add a new partition</span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   <span class="built_in">print</span> the partition table</span><br><span class="line">   q   quit without saving changes</span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition<span class="string">'s system id</span></span><br><span class="line"><span class="string">   u   change display/entry units</span></span><br><span class="line"><span class="string">   v   verify the partition table</span></span><br><span class="line"><span class="string">   w   write table to disk and exit</span></span><br><span class="line"><span class="string">   x   extra functionality (experts only)</span></span><br></pre></td></tr></table></figure>
<p>查看完帮助后，建议的处理方式为：</p>
<ol>
<li>输入：n，表示添加一个新的分区</li>
<li>输入：p，表示创建分区</li>
<li>输入：1，表示创建主分区（分区标号为1）</li>
<li>输入：回车或你指定的值，表示分区大小</li>
<li>输入：回车，表示确定。</li>
<li>输入：w，表示保存分区信息</li>
</ol>
<p>下面是操作案例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): &lt;span style=<span class="string">"color:red"</span>&gt;n&lt;/span&gt;</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-13054, default 1): </span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-13054, default 13054): </span><br><span class="line">Using default value 13054</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
<p>自此，完成分区工作，你可以查看你刚完成的分区信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ fdisk -l</span><br><span class="line">	</span><br><span class="line">Disk /dev/xvda: 21.5 GB, 21474836480 bytes</span><br><span class="line">……</span><br><span class="line">Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/xvda1   *           1        2611    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: 107.4 GB, 107374182400 bytes</span><br><span class="line">……</span><br><span class="line">Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/xvdb1               1       13054   104856223+  83  Linux</span><br></pre></td></tr></table></figure>
<blockquote>
<p>/dev/xvdb1 就是新数据磁盘的分区</p>
</blockquote>
<h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/xvdb1</span><br></pre></td></tr></table></figure>
<p>命令运行后，正常情况会自动完成格式化工作，请稍等一会。最后的日志显示如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ mkfs.ext4 /dev/xvdb1</span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">6553600 inodes, 26214055 blocks</span><br><span class="line">1310702 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=4294967296</span><br><span class="line">800 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, </span><br><span class="line">	4096000, 7962624, 11239424, 20480000, 23887872</span><br><span class="line"></span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 35 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br></pre></td></tr></table></figure>
<h3 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h3><p>挂载分区前，选确定需要挂载到OS的哪个目录，所有请先创建挂载的目标目录，我这里使用/data目录进行挂载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data</span><br></pre></td></tr></table></figure>
<p>然后，不推荐直接用mount命令挂载，而是使用在/etc/fstab增加挂载配置，这样采用在OS重启后自动挂载该磁盘。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'/dev/xvdb1  /data ext4    defaults    0  0'</span> &gt;&gt; /etc/fstab</span><br><span class="line">mount /data</span><br><span class="line">cat /etc/fstab</span><br></pre></td></tr></table></figure>
<p>自此完成初始化数据盘，可以在/data目录使用100G磁盘。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /data/</span><br><span class="line">lost+found</span><br></pre></td></tr></table></figure>
<p>df命令查看磁盘分区信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/xvda1       20G  1.5G   18G   8% /</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">/dev/xvdb1       99G  188M   94G   1% /data</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpeg"
                alt="zhang pu" />
            
              <p class="site-author-name" itemprop="name">zhang pu</p>
              <p class="site-description motion-element" itemprop="description">本质是个程序猿，会点产品，懂点业务，有帮可信赖的志同道合的同伴，做点组织管理，基础架构和应用架构的事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://bohr.me/" title="qiubo's life" target="_blank">qiubo's life</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.1119e.com/" title="投资1119e" target="_blank">投资1119e</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.pccb.com" title="普资金服" target="_blank">普资金服</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhang pu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
